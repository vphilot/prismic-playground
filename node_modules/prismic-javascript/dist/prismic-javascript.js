(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory(require("fetch-everywhere"));
	else if(typeof define === 'function' && define.amd)
		define("PrismicJS", ["fetch-everywhere"], factory);
	else if(typeof exports === 'object')
		exports["PrismicJS"] = factory(require("fetch-everywhere"));
	else
		root["PrismicJS"] = factory(root["fetch-everywhere"]);
})(this, function(__WEBPACK_EXTERNAL_MODULE_3__) {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 2);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/*!***************************!*\
  !*** ./src/predicates.ts ***!
  \***************************/
/*! no static exports found */
/*! all exports used */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nexports.__esModule = true;\nvar Operator = {\n    at: \"at\",\n    not: \"not\",\n    missing: \"missing\",\n    has: \"has\",\n    any: \"any\",\n    \"in\": \"in\",\n    fulltext: \"fulltext\",\n    similar: \"similar\",\n    \"number.gt\": \"number.gt\",\n    \"number.lt\": \"number.lt\",\n    \"number.inRange\": \"number.inRange\",\n    \"date.before\": \"date.before\",\n    \"date.after\": \"date.after\",\n    \"date.between\": \"date.between\",\n    \"date.day-of-month\": \"date.day-of-month\",\n    \"date.day-of-month-after\": \"date.day-of-month-after\",\n    \"date.day-of-month-before\": \"date.day-of-month-before\",\n    \"date.day-of-week\": \"date.day-of-week\",\n    \"date.day-of-week-after\": \"date.day-of-week-after\",\n    \"date.day-of-week-before\": \"date.day-of-week-before\",\n    \"date.month\": \"date.month\",\n    \"date.month-before\": \"date.month-before\",\n    \"date.month-after\": \"date.month-after\",\n    \"date.year\": \"date.year\",\n    \"date.hour\": \"date.hour\",\n    \"date.hour-before\": \"date.hour-before\",\n    \"date.hour-after\": \"date.hour-after\",\n    \"geopoint.near\": \"geopoint.near\"\n};\nfunction encode(value) {\n    if (typeof value === 'string') {\n        return \"\\\"\" + value + \"\\\"\";\n    }\n    else if (value instanceof Array) {\n        return \"[\" + value.map(function (v) { return encode(v); }).join(',') + \"]\";\n    }\n    else if (typeof value === 'number') {\n        return value;\n    }\n    else {\n        return null;\n    }\n}\nvar geopoint = {\n    near: function (fragment, latitude, longitude, radius) {\n        return \"[\" + Operator[\"geopoint.near\"] + \"(\" + fragment + \", \" + latitude + \", \" + longitude + \", \" + radius + \")]\";\n    }\n};\nvar date = {\n    before: function (fragment, before) {\n        return \"[\" + Operator[\"date.before\"] + \"(\" + fragment + \", \" + before.getTime() + \")]\";\n    },\n    after: function (fragment, after) {\n        return \"[\" + Operator[\"date.after\"] + \"(\" + fragment + \", \" + after.getTime() + \")]\";\n    },\n    between: function (fragment, before, after) {\n        return \"[\" + Operator[\"date.between\"] + \"(\" + fragment + \", \" + before.getTime() + \", \" + after.getTime() + \")]\";\n    },\n    dayOfMonth: function (fragment, day) {\n        return \"[\" + Operator[\"date.day-of-month\"] + \"(\" + fragment + \", \" + day + \")]\";\n    },\n    dayOfMonthAfter: function (fragment, day) {\n        return \"[\" + Operator[\"date.day-of-month-after\"] + \"(\" + fragment + \", \" + day + \")]\";\n    },\n    dayOfMonthBefore: function (fragment, day) {\n        return \"[\" + Operator[\"date.day-of-month-before\"] + \"(\" + fragment + \", \" + day + \")]\";\n    },\n    dayOfWeek: function (fragment, day) {\n        return \"[\" + Operator[\"date.day-of-week\"] + \"(\" + fragment + \", \" + day + \")]\";\n    },\n    dayOfWeekAfter: function (fragment, day) {\n        return \"[\" + Operator[\"date.day-of-week-after\"] + \"(\" + fragment + \", \" + day + \")]\";\n    },\n    dayOfWeekBefore: function (fragment, day) {\n        return \"[\" + Operator[\"date.day-of-week-before\"] + \"(\" + fragment + \", \" + day + \")]\";\n    },\n    month: function (fragment, month) {\n        if (typeof month === 'number') {\n            return \"[\" + Operator[\"date.month\"] + \"(\" + fragment + \", \" + month + \")]\";\n        }\n        else {\n            return \"[\" + Operator[\"date.month\"] + \"(\" + fragment + \", \\\"\" + month + \"\\\")]\";\n        }\n    },\n    monthBefore: function (fragment, month) {\n        if (typeof month === 'number') {\n            return \"[\" + Operator[\"date.month-before\"] + \"(\" + fragment + \", \" + month + \")]\";\n        }\n        else {\n            return \"[\" + Operator[\"date.month-before\"] + \"(\" + fragment + \", \\\"\" + month + \"\\\")]\";\n        }\n    },\n    monthAfter: function (fragment, month) {\n        if (typeof month === 'number') {\n            return \"[\" + Operator[\"date.month-after\"] + \"(\" + fragment + \", \" + month + \")]\";\n        }\n        else {\n            return \"[\" + Operator[\"date.month-after\"] + \"(\" + fragment + \", \\\"\" + month + \"\\\")]\";\n        }\n    },\n    year: function (fragment, year) {\n        return \"[\" + Operator[\"date.year\"] + \"(\" + fragment + \", \" + year + \")]\";\n    },\n    hour: function (fragment, hour) {\n        return \"[\" + Operator[\"date.hour\"] + \"(\" + fragment + \", \" + hour + \")]\";\n    },\n    hourBefore: function (fragment, hour) {\n        return \"[\" + Operator[\"date.hour-before\"] + \"(\" + fragment + \", \" + hour + \")]\";\n    },\n    hourAfter: function (fragment, hour) {\n        return \"[\" + Operator[\"date.hour-after\"] + \"(\" + fragment + \", \" + hour + \")]\";\n    }\n};\nvar number = {\n    gt: function (fragment, value) {\n        return \"[\" + Operator[\"number.gt\"] + \"(\" + fragment + \", \" + value + \")]\";\n    },\n    lt: function (fragment, value) {\n        return \"[\" + Operator[\"number.lt\"] + \"(\" + fragment + \", \" + value + \")]\";\n    },\n    inRange: function (fragment, before, after) {\n        return \"[\" + Operator[\"number.inRange\"] + \"(\" + fragment + \", \" + before + \", \" + after + \")]\";\n    }\n};\nexports[\"default\"] = {\n    at: function (fragment, value) {\n        return \"[\" + Operator.at + \"(\" + fragment + \", \" + encode(value) + \")]\";\n    },\n    not: function (fragment, value) {\n        return \"[\" + Operator.not + \"(\" + fragment + \", \" + encode(value) + \")]\";\n    },\n    missing: function (fragment) {\n        return \"[\" + Operator.missing + \"(\" + fragment + \")]\";\n    },\n    has: function (fragment) {\n        return \"[\" + Operator.has + \"(\" + fragment + \")]\";\n    },\n    any: function (fragment, values) {\n        return \"[\" + Operator.any + \"(\" + fragment + \", \" + encode(values) + \")]\";\n    },\n    \"in\": function (fragment, values) {\n        return \"[\" + Operator[\"in\"] + \"(\" + fragment + \", \" + encode(values) + \")]\";\n    },\n    fulltext: function (fragment, value) {\n        return \"[\" + Operator.fulltext + \"(\" + fragment + \", \" + encode(value) + \")]\";\n    },\n    similar: function (documentId, maxResults) {\n        return \"[\" + Operator.similar + \"(\\\"\" + documentId + \"\\\", \" + maxResults + \")]\";\n    },\n    date: date,\n    dateBefore: date.before,\n    dateAfter: date.after,\n    dateBetween: date.between,\n    dayOfMonth: date.dayOfMonth,\n    dayOfMonthAfter: date.dayOfMonthAfter,\n    dayOfMonthBefore: date.dayOfMonthBefore,\n    dayOfWeek: date.dayOfWeek,\n    dayOfWeekAfter: date.dayOfWeekAfter,\n    dayOfWeekBefore: date.dayOfWeekBefore,\n    month: date.month,\n    monthBefore: date.monthBefore,\n    monthAfter: date.monthAfter,\n    year: date.year,\n    hour: date.hour,\n    hourBefore: date.hourBefore,\n    hourAfter: date.hourAfter,\n    number: number,\n    gt: number.gt,\n    lt: number.lt,\n    inRange: number.inRange,\n    near: geopoint.near,\n    geopoint: geopoint\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9wcmVkaWNhdGVzLnRzPzU4ZmEiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgT3BlcmF0b3IgPSB7XG4gIGF0OiBcImF0XCIsXG4gIG5vdDogXCJub3RcIixcbiAgbWlzc2luZzogXCJtaXNzaW5nXCIsXG4gIGhhczogXCJoYXNcIixcbiAgYW55OiBcImFueVwiLFxuICBpbjogXCJpblwiLFxuICBmdWxsdGV4dDogXCJmdWxsdGV4dFwiLFxuICBzaW1pbGFyOiBcInNpbWlsYXJcIixcbiAgXCJudW1iZXIuZ3RcIjogXCJudW1iZXIuZ3RcIixcbiAgXCJudW1iZXIubHRcIjogXCJudW1iZXIubHRcIixcbiAgXCJudW1iZXIuaW5SYW5nZVwiOiBcIm51bWJlci5pblJhbmdlXCIsXG4gIFwiZGF0ZS5iZWZvcmVcIjogXCJkYXRlLmJlZm9yZVwiLFxuICBcImRhdGUuYWZ0ZXJcIjogXCJkYXRlLmFmdGVyXCIsXG4gIFwiZGF0ZS5iZXR3ZWVuXCI6IFwiZGF0ZS5iZXR3ZWVuXCIsXG4gIFwiZGF0ZS5kYXktb2YtbW9udGhcIjogXCJkYXRlLmRheS1vZi1tb250aFwiLFxuICBcImRhdGUuZGF5LW9mLW1vbnRoLWFmdGVyXCI6IFwiZGF0ZS5kYXktb2YtbW9udGgtYWZ0ZXJcIixcbiAgXCJkYXRlLmRheS1vZi1tb250aC1iZWZvcmVcIjogXCJkYXRlLmRheS1vZi1tb250aC1iZWZvcmVcIixcbiAgXCJkYXRlLmRheS1vZi13ZWVrXCI6IFwiZGF0ZS5kYXktb2Ytd2Vla1wiLFxuICBcImRhdGUuZGF5LW9mLXdlZWstYWZ0ZXJcIjogXCJkYXRlLmRheS1vZi13ZWVrLWFmdGVyXCIsXG4gIFwiZGF0ZS5kYXktb2Ytd2Vlay1iZWZvcmVcIjogXCJkYXRlLmRheS1vZi13ZWVrLWJlZm9yZVwiLFxuICBcImRhdGUubW9udGhcIjogXCJkYXRlLm1vbnRoXCIsXG4gIFwiZGF0ZS5tb250aC1iZWZvcmVcIjogXCJkYXRlLm1vbnRoLWJlZm9yZVwiLFxuICBcImRhdGUubW9udGgtYWZ0ZXJcIjogXCJkYXRlLm1vbnRoLWFmdGVyXCIsXG4gIFwiZGF0ZS55ZWFyXCI6IFwiZGF0ZS55ZWFyXCIsXG4gIFwiZGF0ZS5ob3VyXCI6IFwiZGF0ZS5ob3VyXCIsXG4gIFwiZGF0ZS5ob3VyLWJlZm9yZVwiOiBcImRhdGUuaG91ci1iZWZvcmVcIixcbiAgXCJkYXRlLmhvdXItYWZ0ZXJcIjogXCJkYXRlLmhvdXItYWZ0ZXJcIixcbiAgXCJnZW9wb2ludC5uZWFyXCI6IFwiZ2VvcG9pbnQubmVhclwiXG59XG5cbmZ1bmN0aW9uIGVuY29kZSh2YWx1ZTogc3RyaW5nIHwgc3RyaW5nW10pOiBzdHJpbmcgfCBudWxsIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gYFwiJHt2YWx1ZX1cImA7XG4gIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgIHJldHVybiBgWyR7dmFsdWUubWFwKHYgPT4gZW5jb2RlKHYpKS5qb2luKCcsJyl9XWA7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5jb25zdCBnZW9wb2ludCA9IHtcbiAgbmVhcihmcmFnbWVudDogc3RyaW5nLCBsYXRpdHVkZTogbnVtYmVyLCBsb25naXR1ZGU6IG51bWJlciwgcmFkaXVzOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiBgWyR7T3BlcmF0b3JbXCJnZW9wb2ludC5uZWFyXCJdfSgke2ZyYWdtZW50fSwgJHtsYXRpdHVkZX0sICR7bG9uZ2l0dWRlfSwgJHtyYWRpdXN9KV1gO1xuICB9LFxufTtcblxuY29uc3QgZGF0ZSA9IHtcblxuICBiZWZvcmUoZnJhZ21lbnQ6IHN0cmluZywgYmVmb3JlOiBEYXRlKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFske09wZXJhdG9yW1wiZGF0ZS5iZWZvcmVcIl19KCR7ZnJhZ21lbnR9LCAke2JlZm9yZS5nZXRUaW1lKCl9KV1gO1xuICB9LFxuXG4gIGFmdGVyKGZyYWdtZW50OiBzdHJpbmcsIGFmdGVyOiBEYXRlKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFske09wZXJhdG9yW1wiZGF0ZS5hZnRlclwiXX0oJHtmcmFnbWVudH0sICR7YWZ0ZXIuZ2V0VGltZSgpfSldYDtcbiAgfSxcblxuICBiZXR3ZWVuKGZyYWdtZW50OiBzdHJpbmcsIGJlZm9yZTogRGF0ZSwgYWZ0ZXI6IERhdGUpOiBzdHJpbmcge1xuICAgIHJldHVybiBgWyR7T3BlcmF0b3JbXCJkYXRlLmJldHdlZW5cIl19KCR7ZnJhZ21lbnR9LCAke2JlZm9yZS5nZXRUaW1lKCl9LCAke2FmdGVyLmdldFRpbWUoKX0pXWA7XG4gIH0sXG5cbiAgZGF5T2ZNb250aChmcmFnbWVudDogc3RyaW5nLCBkYXk6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBbJHtPcGVyYXRvcltcImRhdGUuZGF5LW9mLW1vbnRoXCJdfSgke2ZyYWdtZW50fSwgJHtkYXl9KV1gO1xuICB9LFxuXG4gIGRheU9mTW9udGhBZnRlcihmcmFnbWVudDogc3RyaW5nLCBkYXk6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBbJHtPcGVyYXRvcltcImRhdGUuZGF5LW9mLW1vbnRoLWFmdGVyXCJdfSgke2ZyYWdtZW50fSwgJHtkYXl9KV1gO1xuICB9LFxuXG4gIGRheU9mTW9udGhCZWZvcmUoZnJhZ21lbnQ6IHN0cmluZywgZGF5OiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiBgWyR7T3BlcmF0b3JbXCJkYXRlLmRheS1vZi1tb250aC1iZWZvcmVcIl19KCR7ZnJhZ21lbnR9LCAke2RheX0pXWA7XG4gIH0sXG5cbiAgZGF5T2ZXZWVrKGZyYWdtZW50OiBzdHJpbmcsIGRheTogbnVtYmVyKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFske09wZXJhdG9yW1wiZGF0ZS5kYXktb2Ytd2Vla1wiXX0oJHtmcmFnbWVudH0sICR7ZGF5fSldYDtcbiAgfSxcblxuICBkYXlPZldlZWtBZnRlcihmcmFnbWVudDogc3RyaW5nLCBkYXk6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBbJHtPcGVyYXRvcltcImRhdGUuZGF5LW9mLXdlZWstYWZ0ZXJcIl19KCR7ZnJhZ21lbnR9LCAke2RheX0pXWA7XG4gIH0sXG5cbiAgZGF5T2ZXZWVrQmVmb3JlKGZyYWdtZW50OiBzdHJpbmcsIGRheTogbnVtYmVyKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFske09wZXJhdG9yW1wiZGF0ZS5kYXktb2Ytd2Vlay1iZWZvcmVcIl19KCR7ZnJhZ21lbnR9LCAke2RheX0pXWA7XG4gIH0sXG5cbiAgbW9udGgoZnJhZ21lbnQ6IHN0cmluZywgbW9udGg6IG51bWJlciB8IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKHR5cGVvZiBtb250aCA9PT0gJ251bWJlcicpIHtcbiAgICAgIHJldHVybiBgWyR7T3BlcmF0b3JbXCJkYXRlLm1vbnRoXCJdfSgke2ZyYWdtZW50fSwgJHttb250aH0pXWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgWyR7T3BlcmF0b3JbXCJkYXRlLm1vbnRoXCJdfSgke2ZyYWdtZW50fSwgXCIke21vbnRofVwiKV1gO1xuICAgIH1cbiAgfSxcblxuICBtb250aEJlZm9yZShmcmFnbWVudDogc3RyaW5nLCBtb250aDogbnVtYmVyIHwgc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZih0eXBlb2YgbW9udGggPT09ICdudW1iZXInKSB7XG4gICAgICByZXR1cm4gYFske09wZXJhdG9yW1wiZGF0ZS5tb250aC1iZWZvcmVcIl19KCR7ZnJhZ21lbnR9LCAke21vbnRofSldYDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGBbJHtPcGVyYXRvcltcImRhdGUubW9udGgtYmVmb3JlXCJdfSgke2ZyYWdtZW50fSwgXCIke21vbnRofVwiKV1gO1xuICAgIH1cbiAgfSxcblxuICBtb250aEFmdGVyKGZyYWdtZW50OiBzdHJpbmcsIG1vbnRoOiBudW1iZXIgfCBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmICh0eXBlb2YgbW9udGggPT09ICdudW1iZXInKSB7XG4gICAgICByZXR1cm4gYFske09wZXJhdG9yW1wiZGF0ZS5tb250aC1hZnRlclwiXX0oJHtmcmFnbWVudH0sICR7bW9udGh9KV1gO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYFske09wZXJhdG9yW1wiZGF0ZS5tb250aC1hZnRlclwiXX0oJHtmcmFnbWVudH0sIFwiJHttb250aH1cIildYDtcbiAgICB9XG4gIH0sXG5cbiAgeWVhcihmcmFnbWVudDogc3RyaW5nLCB5ZWFyOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiBgWyR7T3BlcmF0b3JbXCJkYXRlLnllYXJcIl19KCR7ZnJhZ21lbnR9LCAke3llYXJ9KV1gO1xuICB9LFxuXG4gIGhvdXIoZnJhZ21lbnQ6IHN0cmluZywgaG91cjogbnVtYmVyKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFske09wZXJhdG9yW1wiZGF0ZS5ob3VyXCJdfSgke2ZyYWdtZW50fSwgJHtob3VyfSldYDtcbiAgfSxcblxuICBob3VyQmVmb3JlKGZyYWdtZW50OiBzdHJpbmcsIGhvdXI6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBbJHtPcGVyYXRvcltcImRhdGUuaG91ci1iZWZvcmVcIl19KCR7ZnJhZ21lbnR9LCAke2hvdXJ9KV1gO1xuICB9LFxuXG4gIGhvdXJBZnRlcihmcmFnbWVudDogc3RyaW5nLCBob3VyOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiBgWyR7T3BlcmF0b3JbXCJkYXRlLmhvdXItYWZ0ZXJcIl19KCR7ZnJhZ21lbnR9LCAke2hvdXJ9KV1gO1xuICB9LFxufTtcblxuY29uc3QgbnVtYmVyID0ge1xuICBndChmcmFnbWVudDogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFske09wZXJhdG9yW1wibnVtYmVyLmd0XCJdfSgke2ZyYWdtZW50fSwgJHt2YWx1ZX0pXWA7XG4gIH0sXG5cbiAgbHQoZnJhZ21lbnQ6IHN0cmluZywgdmFsdWU6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBbJHtPcGVyYXRvcltcIm51bWJlci5sdFwiXX0oJHtmcmFnbWVudH0sICR7dmFsdWV9KV1gO1xuICB9LFxuXG4gIGluUmFuZ2UoZnJhZ21lbnQ6IHN0cmluZywgYmVmb3JlOiBudW1iZXIsIGFmdGVyOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiBgWyR7T3BlcmF0b3JbXCJudW1iZXIuaW5SYW5nZVwiXX0oJHtmcmFnbWVudH0sICR7YmVmb3JlfSwgJHthZnRlcn0pXWA7XG4gIH0sXG59O1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGF0KGZyYWdtZW50OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBzdHJpbmdbXSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBbJHtPcGVyYXRvci5hdH0oJHtmcmFnbWVudH0sICR7ZW5jb2RlKHZhbHVlKX0pXWA7XG4gIH0sXG4gIFxuICBub3QoZnJhZ21lbnQ6IHN0cmluZywgdmFsdWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBbJHtPcGVyYXRvci5ub3R9KCR7ZnJhZ21lbnR9LCAke2VuY29kZSh2YWx1ZSl9KV1gO1xuICB9LFxuXG4gIG1pc3NpbmcoZnJhZ21lbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBbJHtPcGVyYXRvci5taXNzaW5nfSgke2ZyYWdtZW50fSldYDtcbiAgfSxcblxuICBoYXMoZnJhZ21lbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBbJHtPcGVyYXRvci5oYXN9KCR7ZnJhZ21lbnR9KV1gO1xuICB9LFxuXG4gIGFueShmcmFnbWVudDogc3RyaW5nLCB2YWx1ZXM6IHN0cmluZ1tdKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFske09wZXJhdG9yLmFueX0oJHtmcmFnbWVudH0sICR7ZW5jb2RlKHZhbHVlcyl9KV1gO1xuICB9LFxuXG4gIGluKGZyYWdtZW50OiBzdHJpbmcsIHZhbHVlczogc3RyaW5nW10pOiBzdHJpbmcge1xuICAgIHJldHVybiBgWyR7T3BlcmF0b3IuaW59KCR7ZnJhZ21lbnR9LCAke2VuY29kZSh2YWx1ZXMpfSldYDtcbiAgfSxcblxuICBmdWxsdGV4dChmcmFnbWVudDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFske09wZXJhdG9yLmZ1bGx0ZXh0fSgke2ZyYWdtZW50fSwgJHtlbmNvZGUodmFsdWUpfSldYDtcbiAgfSxcblxuICBzaW1pbGFyKGRvY3VtZW50SWQ6IHN0cmluZywgbWF4UmVzdWx0czogbnVtYmVyKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFske09wZXJhdG9yLnNpbWlsYXJ9KFwiJHtkb2N1bWVudElkfVwiLCAke21heFJlc3VsdHN9KV1gO1xuICB9LFxuXG4gIGRhdGUsXG5cbiAgZGF0ZUJlZm9yZTogZGF0ZS5iZWZvcmUsXG5cbiAgZGF0ZUFmdGVyOiBkYXRlLmFmdGVyLFxuXG4gIGRhdGVCZXR3ZWVuOiBkYXRlLmJldHdlZW4sXG5cbiAgZGF5T2ZNb250aDogZGF0ZS5kYXlPZk1vbnRoLFxuXG4gIGRheU9mTW9udGhBZnRlcjogZGF0ZS5kYXlPZk1vbnRoQWZ0ZXIsXG5cbiAgZGF5T2ZNb250aEJlZm9yZTogZGF0ZS5kYXlPZk1vbnRoQmVmb3JlLFxuXG4gIGRheU9mV2VlazogZGF0ZS5kYXlPZldlZWssXG5cbiAgZGF5T2ZXZWVrQWZ0ZXI6IGRhdGUuZGF5T2ZXZWVrQWZ0ZXIsXG5cbiAgZGF5T2ZXZWVrQmVmb3JlOiBkYXRlLmRheU9mV2Vla0JlZm9yZSxcblxuICBtb250aDogZGF0ZS5tb250aCxcblxuICBtb250aEJlZm9yZTogZGF0ZS5tb250aEJlZm9yZSxcblxuICBtb250aEFmdGVyOiBkYXRlLm1vbnRoQWZ0ZXIsXG5cbiAgeWVhcjogZGF0ZS55ZWFyLFxuXG4gIGhvdXI6IGRhdGUuaG91cixcblxuICBob3VyQmVmb3JlOiBkYXRlLmhvdXJCZWZvcmUsXG5cbiAgaG91ckFmdGVyOiBkYXRlLmhvdXJBZnRlcixcblxuICBudW1iZXIsXG5cbiAgZ3Q6IG51bWJlci5ndCxcblxuICBsdDogbnVtYmVyLmx0LFxuXG4gIGluUmFuZ2U6IG51bWJlci5pblJhbmdlLFxuXG4gIG5lYXI6IGdlb3BvaW50Lm5lYXIsXG5cbiAgZ2VvcG9pbnQsXG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL3ByZWRpY2F0ZXMudHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBRUE7QUFFQTtBQUVBO0FBRUE7QUFFQTtBQUVBO0FBRUE7QUFFQTtBQUVBO0FBRUE7QUFFQTtBQUVBO0FBRUE7QUFFQTtBQUVBO0FBRUE7QUFFQTtBQUVBO0FBRUE7QUFFQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0\n");

/***/ }),
/* 1 */
/*!****************************!*\
  !*** ./src/experiments.ts ***!
  \****************************/
/*! no static exports found */
/*! all exports used */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nexports.__esModule = true;\nvar Variation = /** @class */ (function () {\n    function Variation(data) {\n        this.data = {};\n        this.data = data;\n    }\n    Variation.prototype.id = function () {\n        return this.data.id;\n    };\n    Variation.prototype.ref = function () {\n        return this.data.ref;\n    };\n    Variation.prototype.label = function () {\n        return this.data.label;\n    };\n    return Variation;\n}());\nexports.Variation = Variation;\nvar Experiment = /** @class */ (function () {\n    function Experiment(data) {\n        this.data = {};\n        this.data = data;\n        this.variations = (data.variations || []).map(function (v) {\n            return new Variation(v);\n        });\n    }\n    Experiment.prototype.id = function () {\n        return this.data.id;\n    };\n    Experiment.prototype.googleId = function () {\n        return this.data.googleId;\n    };\n    Experiment.prototype.name = function () {\n        return this.data.name;\n    };\n    return Experiment;\n}());\nexports.Experiment = Experiment;\nvar Experiments = /** @class */ (function () {\n    function Experiments(data) {\n        if (data) {\n            this.drafts = (data.drafts || []).map(function (exp) {\n                return new Experiment(exp);\n            });\n            this.running = (data.running || []).map(function (exp) {\n                return new Experiment(exp);\n            });\n        }\n    }\n    Experiments.prototype.current = function () {\n        return this.running.length > 0 ? this.running[0] : null;\n    };\n    Experiments.prototype.refFromCookie = function (cookie) {\n        if (!cookie || cookie.trim() === \"\")\n            return null;\n        var splitted = cookie.trim().split(\" \");\n        if (splitted.length < 2)\n            return null;\n        var expId = splitted[0];\n        var varIndex = parseInt(splitted[1], 10);\n        var exp = this.running.filter(function (exp) {\n            return exp.googleId() == expId && exp.variations.length > varIndex;\n        })[0];\n        return exp ? exp.variations[varIndex].ref() : null;\n    };\n    return Experiments;\n}());\nexports.Experiments = Experiments;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9leHBlcmltZW50cy50cz85MjA2Il0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBWYXJpYXRpb24ge1xuICBkYXRhOiBhbnkgPSB7fTtcblxuICBjb25zdHJ1Y3RvcihkYXRhOiBhbnkpIHtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICB9XG5cbiAgaWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLmlkO1xuICB9XG5cbiAgcmVmKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YS5yZWY7XG4gIH1cblxuICBsYWJlbCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmRhdGEubGFiZWw7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEV4cGVyaW1lbnQge1xuICB2YXJpYXRpb25zOiBWYXJpYXRpb25bXTtcbiAgZGF0YTogYW55ID0ge307XG5cbiAgY29uc3RydWN0b3IoZGF0YTogYW55KSB7XG4gICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICB0aGlzLnZhcmlhdGlvbnMgPSAoZGF0YS52YXJpYXRpb25zIHx8IFtdKS5tYXAoKHY6IGFueSkgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBWYXJpYXRpb24odik7XG4gICAgfSk7XG4gIH1cblxuICBpZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmRhdGEuaWQ7XG4gIH1cblxuICBnb29nbGVJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmRhdGEuZ29vZ2xlSWQ7XG4gIH1cblxuICBuYW1lKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YS5uYW1lO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBFeHBlcmltZW50cyB7XG4gIGRyYWZ0czogRXhwZXJpbWVudFtdO1xuICBydW5uaW5nOiBFeHBlcmltZW50W107XG5cbiAgY29uc3RydWN0b3IoZGF0YTogYW55KSB7XG4gICAgaWYoZGF0YSkge1xuICAgICAgdGhpcy5kcmFmdHMgPSAoZGF0YS5kcmFmdHMgfHwgW10pLm1hcCgoZXhwOiBhbnkpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBFeHBlcmltZW50KGV4cCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMucnVubmluZyA9IChkYXRhLnJ1bm5pbmcgfHwgW10pLm1hcCgoZXhwOiBhbnkpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBFeHBlcmltZW50KGV4cCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjdXJyZW50KCk6IEV4cGVyaW1lbnQgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5ydW5uaW5nLmxlbmd0aCA+IDAgPyB0aGlzLnJ1bm5pbmdbMF0gOiBudWxsO1xuICB9XG4gIHJlZkZyb21Db29raWUoY29va2llOiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcbiAgICBpZiAoIWNvb2tpZSB8fCBjb29raWUudHJpbSgpID09PSBcIlwiKSByZXR1cm4gbnVsbDtcbiAgICBjb25zdCBzcGxpdHRlZCA9IGNvb2tpZS50cmltKCkuc3BsaXQoXCIgXCIpO1xuICAgIGlmIChzcGxpdHRlZC5sZW5ndGggPCAyKSByZXR1cm4gbnVsbDtcbiAgICBjb25zdCBleHBJZCA9IHNwbGl0dGVkWzBdO1xuICAgIGNvbnN0IHZhckluZGV4ID0gcGFyc2VJbnQoc3BsaXR0ZWRbMV0sIDEwKTtcbiAgICBjb25zdCBleHAgPSB0aGlzLnJ1bm5pbmcuZmlsdGVyKGZ1bmN0aW9uKGV4cCkge1xuICAgICAgcmV0dXJuIGV4cC5nb29nbGVJZCgpID09IGV4cElkICYmIGV4cC52YXJpYXRpb25zLmxlbmd0aCA+IHZhckluZGV4O1xuICAgIH0pWzBdO1xuICAgIHJldHVybiBleHAgPyBleHAudmFyaWF0aW9uc1t2YXJJbmRleF0ucmVmKCkgOiBudWxsO1xuICB9XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvZXhwZXJpbWVudHMudHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFHQTtBQUZBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFsQkE7QUFvQkE7QUFJQTtBQUZBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUF0QkE7QUF3QkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQTdCQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1\n");

/***/ }),
/* 2 */
/*!*********************************************!*\
  !*** multi fetch-everywhere ./src/index.ts ***!
  \*********************************************/
/*! no static exports found */
/*! all exports used */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(/*! fetch-everywhere */3);
module.exports = __webpack_require__(/*! /Volumes/data/hub/prismic/prismic-javascript1/src/index.ts */4);


/***/ }),
/* 3 */
/*!**********************************************************************************************************************************!*\
  !*** external {"root":"fetch-everywhere","commonjs2":"fetch-everywhere","commonjs":"fetch-everywhere","amd":"fetch-everywhere"} ***!
  \**********************************************************************************************************************************/
/*! no static exports found */
/*! all exports used */
/***/ (function(module, exports) {

eval("module.exports = __WEBPACK_EXTERNAL_MODULE_3__;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9leHRlcm5hbCB7XCJyb290XCI6XCJmZXRjaC1ldmVyeXdoZXJlXCIsXCJjb21tb25qczJcIjpcImZldGNoLWV2ZXJ5d2hlcmVcIixcImNvbW1vbmpzXCI6XCJmZXRjaC1ldmVyeXdoZXJlXCIsXCJhbWRcIjpcImZldGNoLWV2ZXJ5d2hlcmVcIn0/ZTIxNyJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfM19fO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIHtcInJvb3RcIjpcImZldGNoLWV2ZXJ5d2hlcmVcIixcImNvbW1vbmpzMlwiOlwiZmV0Y2gtZXZlcnl3aGVyZVwiLFwiY29tbW9uanNcIjpcImZldGNoLWV2ZXJ5d2hlcmVcIixcImFtZFwiOlwiZmV0Y2gtZXZlcnl3aGVyZVwifVxuLy8gbW9kdWxlIGlkID0gM1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwibWFwcGluZ3MiOiJBQUFBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///3\n");

/***/ }),
/* 4 */
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/*! no static exports found */
/*! all exports used */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nexports.__esModule = true;\nvar predicates_1 = __webpack_require__(/*! ./predicates */ 0);\nvar experiments_1 = __webpack_require__(/*! ./experiments */ 1);\nvar api_1 = __webpack_require__(/*! ./api */ 5);\nfunction getApi(url, options) {\n    var safeOptions = options || {};\n    var api = new api_1.Api(url, safeOptions);\n    //Use cached api data if available\n    return new Promise(function (resolve, reject) {\n        var cb = function (err, api) {\n            if (safeOptions.complete)\n                safeOptions.complete(err, api);\n            if (err) {\n                reject(err);\n            }\n            else {\n                resolve(api);\n            }\n        };\n        api.get(function (err, data) {\n            if (!err && data) {\n                api.data = data;\n                api.refs = data.refs;\n                api.tags = data.tags;\n                api.types = data.types;\n                api.forms = data.forms;\n                api.bookmarks = data.bookmarks;\n                api.experiments = new experiments_1.Experiments(data.experiments);\n            }\n            cb(err, api);\n        });\n        return api;\n    });\n}\nmodule.exports = {\n    experimentCookie: api_1.ExperimentCookie,\n    previewCookie: api_1.PreviewCookie,\n    Predicates: predicates_1[\"default\"],\n    Experiments: experiments_1.Experiments,\n    api: getApi,\n    Api: api_1.Api,\n    getApi: getApi\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9pbmRleC50cz9lYWMzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcmVkaWNhdGVzIGZyb20gJy4vcHJlZGljYXRlcyc7XG5pbXBvcnQgeyBEZWZhdWx0UmVxdWVzdEhhbmRsZXIgfSBmcm9tICcuL3JlcXVlc3QnO1xuaW1wb3J0IHsgRXhwZXJpbWVudHMgfSBmcm9tICcuL2V4cGVyaW1lbnRzJztcblxuaW1wb3J0IHtcbiAgQXBpT3B0aW9ucyxcbiAgQXBpLFxuICBFeHBlcmltZW50Q29va2llLFxuICBQcmV2aWV3Q29va2llLFxufSBmcm9tIFwiLi9hcGlcIjtcblxuZnVuY3Rpb24gZ2V0QXBpKHVybDogc3RyaW5nLCBvcHRpb25zOiBBcGlPcHRpb25zIHwgbnVsbCk6IFByb21pc2U8QXBpPiB7XG4gIGNvbnN0IHNhZmVPcHRpb25zID0gb3B0aW9ucyB8fCB7fSBhcyBBcGlPcHRpb25zO1xuICB2YXIgYXBpID0gbmV3IEFwaSh1cmwsIHNhZmVPcHRpb25zKTtcbiAgLy9Vc2UgY2FjaGVkIGFwaSBkYXRhIGlmIGF2YWlsYWJsZVxuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgdmFyIGNiID0gZnVuY3Rpb24oZXJyOiBFcnJvciB8IG51bGwsIGFwaT86IGFueSkge1xuICAgICAgaWYgKHNhZmVPcHRpb25zLmNvbXBsZXRlKSBzYWZlT3B0aW9ucy5jb21wbGV0ZShlcnIsIGFwaSk7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzb2x2ZShhcGkpO1xuICAgICAgfVxuICAgIH07XG4gICAgYXBpLmdldChmdW5jdGlvbiAoZXJyOiBFcnJvciwgZGF0YTogYW55KSB7XG4gICAgICBpZiAoIWVyciAmJiBkYXRhKSB7XG4gICAgICAgIGFwaS5kYXRhID0gZGF0YTtcbiAgICAgICAgYXBpLnJlZnMgPSBkYXRhLnJlZnM7XG4gICAgICAgIGFwaS50YWdzID0gZGF0YS50YWdzO1xuICAgICAgICBhcGkudHlwZXMgPSBkYXRhLnR5cGVzO1xuICAgICAgICBhcGkuZm9ybXMgPSBkYXRhLmZvcm1zO1xuICAgICAgICBhcGkuYm9va21hcmtzID0gZGF0YS5ib29rbWFya3M7XG4gICAgICAgIGFwaS5leHBlcmltZW50cyA9IG5ldyBFeHBlcmltZW50cyhkYXRhLmV4cGVyaW1lbnRzKTtcbiAgICAgIH1cblxuICAgICAgY2IoZXJyLCBhcGkpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGFwaTtcbiAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBleHBlcmltZW50Q29va2llOiBFeHBlcmltZW50Q29va2llLFxuICBwcmV2aWV3Q29va2llOiBQcmV2aWV3Q29va2llLFxuICBQcmVkaWNhdGVzLFxuICBFeHBlcmltZW50cyxcbiAgYXBpOiBnZXRBcGksXG4gIEFwaSxcbiAgZ2V0QXBpXG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2luZGV4LnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBRUE7QUFFQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///4\n");

/***/ }),
/* 5 */
/*!********************!*\
  !*** ./src/api.ts ***!
  \********************/
/*! no static exports found */
/*! all exports used */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nexports.__esModule = true;\nvar predicates_1 = __webpack_require__(/*! ./predicates */ 0);\nvar experiments_1 = __webpack_require__(/*! ./experiments */ 1);\nvar request_1 = __webpack_require__(/*! ./request */ 6);\nvar cache_1 = __webpack_require__(/*! ./cache */ 7);\nvar cookies_1 = __webpack_require__(/*! ./cookies */ 9);\nexports.PreviewCookie = \"io.prismic.preview\";\nexports.ExperimentCookie = \"io.prismic.experiment\";\nvar SearchForm = /** @class */ (function () {\n    function SearchForm(api, form, data) {\n        this.api = api;\n        this.form = form;\n        this.data = data || {};\n        for (var field in form.fields) {\n            if (form.fields[field]['default']) {\n                this.data[field] = [form.fields[field]['default']];\n            }\n        }\n    }\n    SearchForm.prototype.set = function (field, value) {\n        var fieldDesc = this.form.fields[field];\n        if (!fieldDesc)\n            throw new Error('Unknown field ' + field);\n        var checkedValue = value === '' || value === undefined ? null : value;\n        var values = this.data[field] || [];\n        if (fieldDesc.multiple) {\n            values = checkedValue ? values.concat([checkedValue]) : values;\n        }\n        else {\n            values = checkedValue ? [checkedValue] : values;\n        }\n        this.data[field] = values;\n        return this;\n    };\n    /**\n     * Sets a ref to query on for this SearchForm. This is a mandatory\n     * method to call before calling submit(), and api.form('everything').submit()\n     * will not work.\n     */\n    SearchForm.prototype.ref = function (ref) {\n        return this.set(\"ref\", ref);\n    };\n    /**\n     * Sets a predicate-based query for this SearchForm. This is where you\n     * paste what you compose in your prismic.io API browser.\n     */\n    SearchForm.prototype.query = function (query) {\n        if (typeof query === 'string') {\n            return this.query([query]);\n        }\n        else if (query instanceof Array) {\n            return this.set(\"q\", (\"[\" + query.join(\"\") + \"]\"));\n        }\n        else {\n            throw new Error(\"Invalid query : \" + query);\n        }\n    };\n    /**\n     * Sets a page size to query for this SearchForm. This is an optional method.\n     *\n     * @param {number} size - The page size\n     * @returns {SearchForm} - The SearchForm itself\n     */\n    SearchForm.prototype.pageSize = function (size) {\n        return this.set(\"pageSize\", size);\n    };\n    /**\n     * Restrict the results document to the specified fields\n     */\n    SearchForm.prototype.fetch = function (fields) {\n        var strFields = fields instanceof Array ? fields.join(\",\") : fields;\n        return this.set(\"fetch\", strFields);\n    };\n    /**\n     * Include the requested fields in the DocumentLink instances in the result\n     */\n    SearchForm.prototype.fetchLinks = function (fields) {\n        var strFields = fields instanceof Array ? fields.join(\",\") : fields;\n        return this.set(\"fetchLinks\", strFields);\n    };\n    /**\n     * Sets the language to query for this SearchForm. This is an optional method.\n     */\n    SearchForm.prototype.lang = function (langCode) {\n        return this.set(\"lang\", langCode);\n    };\n    /**\n     * Sets the page number to query for this SearchForm. This is an optional method.\n     */\n    SearchForm.prototype.page = function (p) {\n        return this.set(\"page\", p);\n    };\n    /**\n     * Remove all the documents except for those after the specified document in the list. This is an optional method.\n     */\n    SearchForm.prototype.after = function (documentId) {\n        return this.set(\"after\", documentId);\n    };\n    /**\n     * Sets the orderings to query for this SearchForm. This is an optional method.\n     */\n    SearchForm.prototype.orderings = function (orderings) {\n        if (!orderings) {\n            return this;\n        }\n        else {\n            return this.set(\"orderings\", \"[\" + orderings.join(\",\") + \"]\");\n        }\n    };\n    /**\n     * Build the URL to query\n     */\n    SearchForm.prototype.url = function () {\n        var url = this.form.action;\n        if (this.data) {\n            var sep = (url.indexOf('?') > -1 ? '&' : '?');\n            for (var key in this.data) {\n                if (this.data.hasOwnProperty(key)) {\n                    var values = this.data[key];\n                    if (values) {\n                        for (var i = 0; i < values.length; i++) {\n                            url += sep + key + '=' + encodeURIComponent(values[i]);\n                            sep = '&';\n                        }\n                    }\n                }\n            }\n        }\n        return url;\n    };\n    /**\n     * Submits the query, and calls the callback function.\n     */\n    SearchForm.prototype.submit = function (callback) {\n        return this.api.request(this.url(), callback);\n    };\n    return SearchForm;\n}());\nexports.SearchForm = SearchForm;\nvar Api = /** @class */ (function () {\n    function Api(url, options) {\n        var opts = options || {};\n        this.accessToken = opts.accessToken;\n        this.url = url + (this.accessToken ? (url.indexOf('?') > -1 ? '&' : '?') + 'access_token=' + this.accessToken : '');\n        this.req = opts.req;\n        this.apiCache = opts.apiCache || new cache_1.DefaultApiCache();\n        this.requestHandler = opts.requestHandler || new request_1.DefaultRequestHandler({ proxyAgent: opts.proxyAgent });\n        this.apiCacheKey = this.url + (this.accessToken ? ('#' + this.accessToken) : '');\n        this.apiDataTTL = opts.apiDataTTL || 5;\n        return this;\n    }\n    /**\n     * Fetches data used to construct the api client, from cache if it's\n     * present, otherwise from calling the prismic api endpoint (which is\n     * then cached).\n     */\n    Api.prototype.get = function (callback) {\n        var _this = this;\n        var cacheKey = this.apiCacheKey;\n        return new Promise(function (resolve, reject) {\n            var cb = function (err, value, xhr, ttl) {\n                if (callback)\n                    callback(err, value, xhr, ttl);\n                if (value)\n                    resolve(value);\n                if (err)\n                    reject(err);\n            };\n            _this.apiCache.get(cacheKey, function (err, value) {\n                if (err || value) {\n                    cb(err, value);\n                    return;\n                }\n                _this.requestHandler.request(_this.url, function (err, value, xhr, ttl) {\n                    if (err) {\n                        cb(err, null, xhr, ttl);\n                        return;\n                    }\n                    var parsed = _this.parse(value);\n                    ttl = ttl || _this.apiDataTTL;\n                    _this.apiCache.set(cacheKey, parsed, ttl, function (err) {\n                        cb(err, parsed, xhr, ttl);\n                    });\n                });\n            });\n        });\n    };\n    /**\n     * Cleans api data from the cache and fetches an up to date copy.\n     *\n     * @param {function} callback - Optional callback function that is called after the data has been refreshed\n     * @returns {Promise}\n     */\n    Api.prototype.refresh = function (callback) {\n        var cacheKey = this.apiCacheKey;\n        return new Promise(function (resolve, reject) {\n            var _this = this;\n            var cb = function (err, value, xhr) {\n                if (callback)\n                    callback(err, value, xhr);\n                if (value)\n                    resolve(value);\n                if (err)\n                    reject(err);\n            };\n            this.apiCache.remove(cacheKey, function (err) {\n                if (err) {\n                    cb(err);\n                    return;\n                }\n                _this.get(function (err, data) {\n                    if (err) {\n                        cb(err);\n                        return;\n                    }\n                    _this.data = data;\n                    _this.bookmarks = data.bookmarks;\n                    _this.experiments = new experiments_1.Experiments(data.experiments);\n                    cb();\n                });\n            });\n        });\n    };\n    /**\n     * Parses and returns the /api document.\n     * This is for internal use, from outside this kit, you should call Prismic.Api()\n     *\n     * @param {string} data - The JSON document responded on the API's endpoint\n     * @returns {Api} - The Api object that can be manipulated\n     * @private\n     */\n    Api.prototype.parse = function (data) {\n        var _this = this;\n        // Parse the forms\n        var forms = Object.keys(data.forms || []).reduce(function (acc, key, i) {\n            if (data.forms.hasOwnProperty(key)) {\n                var form = data.forms[key];\n                if (_this.accessToken) {\n                    form.fields['access_token'] = {};\n                    form.fields['access_token']['type'] = 'string';\n                    form.fields['access_token']['default'] = _this.accessToken;\n                }\n                acc[key] = form;\n                return acc;\n            }\n            else {\n                return acc;\n            }\n        }, {});\n        var refs = data.refs || [];\n        var master = refs.filter(function (r) { return r.isMasterRef; })[0];\n        var types = data.types;\n        var tags = data.tags;\n        if (!master) {\n            throw (\"No master ref.\");\n        }\n        return {\n            bookmarks: data.bookmarks || {},\n            refs: refs,\n            forms: forms,\n            master: master,\n            types: types,\n            tags: tags,\n            experiments: data.experiments,\n            oauthInitiate: data['oauth_initiate'],\n            oauthToken: data['oauth_token'],\n            quickRoutes: data.quickRoutes\n        };\n    };\n    /**\n     * Returns a useable form from its id, as described in the RESTful description of the API.\n     * For instance: api.form(\"everything\") works on every repository (as \"everything\" exists by default)\n     * You can then chain the calls: api.form(\"everything\").query('[[:d = at(document.id, \"UkL0gMuvzYUANCpf\")]]').ref(ref).submit()\n     */\n    Api.prototype.form = function (formId) {\n        var form = this.data.forms[formId];\n        if (form) {\n            return new SearchForm(this, form, {});\n        }\n        return null;\n    };\n    Api.prototype.everything = function () {\n        var f = this.form(\"everything\");\n        if (!f)\n            throw new Error(\"Missing everything form\");\n        return f;\n    };\n    /**\n     * The ID of the master ref on this prismic.io API.\n     * Do not use like this: searchForm.ref(api.master()).\n     * Instead, set your ref once in a variable, and call it when you need it; this will allow to change the ref you're viewing easily for your entire page.\n     */\n    Api.prototype.master = function () {\n        return this.data.master.ref;\n    };\n    /**\n     * Returns the ref ID for a given ref's label.\n     * Do not use like this: searchForm.ref(api.ref(\"Future release label\")).\n     * Instead, set your ref once in a variable, and call it when you need it; this will allow to change the ref you're viewing easily for your entire page.\n     */\n    Api.prototype.ref = function (label) {\n        for (var i = 0; i < this.data.refs.length; i++) {\n            if (this.data.refs[i].label == label) {\n                return this.data.refs[i].ref;\n            }\n        }\n        return null;\n    };\n    /**\n     * The current experiment, or null\n     */\n    Api.prototype.currentExperiment = function () {\n        return this.experiments.current();\n    };\n    Api.prototype.quickRoutesEnabled = function () {\n        return this.data.quickRoutes.enabled;\n    };\n    /**\n     * Retrieve quick routes definitions\n     */\n    Api.prototype.getQuickRoutes = function (callback) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            _this.requestHandler.request(_this.data.quickRoutes.url, function (err, data, xhr) {\n                if (callback)\n                    callback(err, data, xhr);\n                if (err)\n                    reject(err);\n                if (data)\n                    resolve(data);\n            });\n        });\n    };\n    /**\n     * Query the repository\n     */\n    Api.prototype.query = function (q, optionsOrCallback, cb) {\n        var _a = typeof optionsOrCallback === 'function'\n            ? { options: {}, callback: optionsOrCallback }\n            : { options: optionsOrCallback || {}, callback: cb }, options = _a.options, callback = _a.callback;\n        var opts = options;\n        var form = this.everything();\n        for (var key in opts) {\n            form = form.set(key, opts[key]);\n        }\n        if (!opts['ref']) {\n            // Look in cookies if we have a ref (preview or experiment)\n            var cookieString = '';\n            if (this.req) {\n                cookieString = this.req.headers[\"cookie\"] || '';\n            }\n            else if (typeof window !== 'undefined' && window.document) {\n                cookieString = window.document.cookie || '';\n            }\n            var cookies = cookies_1[\"default\"].parse(cookieString);\n            var previewRef = cookies[exports.PreviewCookie];\n            var experimentRef = this.experiments.refFromCookie(cookies[exports.ExperimentCookie]);\n            form = form.ref(previewRef || experimentRef || this.master());\n        }\n        if (q) {\n            form.query(q);\n        }\n        return form.submit(callback);\n    };\n    /**\n     * Retrieve the document returned by the given query\n     * @param {string|array|Predicate} the query\n     * @param {object} additional parameters. In NodeJS, pass the request as 'req'.\n     * @param {function} callback(err, doc)\n     */\n    Api.prototype.queryFirst = function (q, optionsOrCallback, cb) {\n        var _a = typeof optionsOrCallback === 'function'\n            ? { options: {}, callback: optionsOrCallback }\n            : { options: optionsOrCallback || {}, callback: cb }, options = _a.options, callback = _a.callback;\n        var opts = options;\n        opts.page = 1;\n        opts.pageSize = 1;\n        return this.query(q, opts, function (err, response) {\n            if (callback) {\n                var result = response && response.results && response.results[0];\n                callback(err, result);\n            }\n        }).then(function (response) {\n            return response && response.results && response.results[0];\n        })[\"catch\"](function (e) {\n            console.log(e);\n        });\n    };\n    /**\n     * Retrieve the document with the given id\n     */\n    Api.prototype.getByID = function (id, options, callback) {\n        options = options || {};\n        if (!options.lang)\n            options.lang = '*';\n        return this.queryFirst(predicates_1[\"default\"].at('document.id', id), options, callback);\n    };\n    /**\n     * Retrieve multiple documents from an array of id\n     */\n    Api.prototype.getByIDs = function (ids, options, callback) {\n        options = options || {};\n        if (!options.lang)\n            options.lang = '*';\n        return this.query(predicates_1[\"default\"][\"in\"]('document.id', ids), options, callback);\n    };\n    /**\n     * Retrieve the document with the given uid\n     */\n    Api.prototype.getByUID = function (type, uid, options, callback) {\n        options = options || {};\n        if (!options.lang)\n            options.lang = '*';\n        return this.queryFirst(predicates_1[\"default\"].at(\"my.\" + type + \".uid\", uid), options, callback);\n    };\n    /**\n     * Retrieve the singleton document with the given type\n     */\n    Api.prototype.getSingle = function (type, options, callback) {\n        return this.queryFirst(predicates_1[\"default\"].at('document.type', type), options, callback);\n    };\n    /**\n     * Retrieve the document with the given bookmark\n     */\n    Api.prototype.getBookmark = function (bookmark, options, callback) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            var id = _this.bookmarks[bookmark];\n            if (id) {\n                resolve(id);\n            }\n            else {\n                var err = new Error(\"Error retrieving bookmarked id\");\n                if (callback)\n                    callback(err);\n                reject(err);\n            }\n        }).then(function (id) { return _this.getByID(id, options, callback); });\n    };\n    /**\n     * Return the URL to display a given preview\n     */\n    Api.prototype.previewSession = function (token, linkResolver, defaultUrl, callback) {\n        var api = this;\n        return new Promise(function (resolve, reject) {\n            var cb = function (err, url, xhr) {\n                if (callback)\n                    callback(err, url, xhr);\n                if (err) {\n                    reject(err);\n                }\n                else {\n                    resolve(url);\n                }\n            };\n            api.requestHandler.request(token, function (err, result, xhr) {\n                if (err) {\n                    cb(err, defaultUrl, xhr);\n                    return;\n                }\n                try {\n                    var mainDocumentId = result.mainDocument;\n                    if (!mainDocumentId) {\n                        cb(null, defaultUrl, xhr);\n                    }\n                    else {\n                        api.everything().query(predicates_1[\"default\"].at(\"document.id\", mainDocumentId)).ref(token).lang('*').submit(function (err, response) {\n                            if (err) {\n                                cb(err);\n                            }\n                            try {\n                                if (response.results.length === 0) {\n                                    cb(null, defaultUrl, xhr);\n                                }\n                                else {\n                                    cb(null, linkResolver(response.results[0]), xhr);\n                                }\n                            }\n                            catch (e) {\n                                cb(e);\n                            }\n                        });\n                    }\n                }\n                catch (e) {\n                    cb(e, defaultUrl, xhr);\n                }\n            });\n        });\n    };\n    /**\n     * Fetch a URL corresponding to a query, and parse the response as a Response object\n     */\n    Api.prototype.request = function (url, callback) {\n        var api = this;\n        var cacheKey = url + (this.accessToken ? ('#' + this.accessToken) : '');\n        var cache = this.apiCache;\n        function run(cb) {\n            cache.get(cacheKey, function (err, value) {\n                if (err || value) {\n                    cb(err, value);\n                    return;\n                }\n                api.requestHandler.request(url, function (err, documents, xhr, ttl) {\n                    if (err) {\n                        cb(err, null, xhr);\n                        return;\n                    }\n                    if (ttl) {\n                        cache.set(cacheKey, documents, ttl, function (err) {\n                            cb(err, documents);\n                        });\n                    }\n                    else {\n                        cb(null, documents);\n                    }\n                });\n            });\n        }\n        return new Promise(function (resolve, reject) {\n            run(function (err, value, xhr) {\n                if (callback)\n                    callback(err, value, xhr);\n                if (err)\n                    reject(err);\n                if (value)\n                    resolve(value);\n            });\n        });\n    };\n    Api.prototype.getNextPage = function (nextPage, callback) {\n        return this.request(nextPage + (this.accessToken ? '&access_token=' + this.accessToken : ''), callback);\n    };\n    return Api;\n}());\nexports.Api = Api;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9hcGkudHM/OTJlZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUHJlZGljYXRlcyBmcm9tICcuL3ByZWRpY2F0ZXMnO1xuaW1wb3J0IHsgRXhwZXJpbWVudCwgRXhwZXJpbWVudHMgfSBmcm9tICcuL2V4cGVyaW1lbnRzJztcbmltcG9ydCB7IFJlcXVlc3RIYW5kbGVyLCBEZWZhdWx0UmVxdWVzdEhhbmRsZXIgfSBmcm9tICcuL3JlcXVlc3QnO1xuaW1wb3J0IHsgRG9jdW1lbnQgfSBmcm9tICcuL2RvY3VtZW50cyc7XG5pbXBvcnQgeyBBcGlDYWNoZSwgRGVmYXVsdEFwaUNhY2hlIH0gZnJvbSAnLi9jYWNoZSc7XG5pbXBvcnQgQ29va2llcyBmcm9tICcuL2Nvb2tpZXMnO1xuXG5leHBvcnQgY29uc3QgUHJldmlld0Nvb2tpZSA9IFwiaW8ucHJpc21pYy5wcmV2aWV3XCI7XG5leHBvcnQgY29uc3QgRXhwZXJpbWVudENvb2tpZSA9IFwiaW8ucHJpc21pYy5leHBlcmltZW50XCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVmIHtcbiAgcmVmOiBzdHJpbmc7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIGlzTWFzdGVyUmVmOiBzdHJpbmc7XG4gIHNjaGVkdWxlZEF0OiBzdHJpbmc7XG4gIGlkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmllbGQge1xuICBba2V5OiBzdHJpbmddOiBzdHJpbmc7XG4gIHZhbHVlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRm9ybSB7XG4gIGZpZWxkczogYW55O1xuICBhY3Rpb246IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICByZWw6IHN0cmluZztcbiAgZm9ybV9tZXRob2Q6IHN0cmluZztcbiAgZW5jdHlwZTogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgU2VhcmNoRm9ybSB7XG4gIGFwaTogQXBpO1xuICBmb3JtOiBGb3JtO1xuICBkYXRhOiBhbnk7XG5cbiAgY29uc3RydWN0b3IoYXBpOiBBcGksIGZvcm06IEZvcm0sIGRhdGE6IGFueSkge1xuICAgIHRoaXMuYXBpID0gYXBpO1xuICAgIHRoaXMuZm9ybSA9IGZvcm07XG4gICAgdGhpcy5kYXRhID0gZGF0YSB8fCB7fTtcblxuICAgIGZvcih2YXIgZmllbGQgaW4gZm9ybS5maWVsZHMpIHtcbiAgICAgIGlmKGZvcm0uZmllbGRzW2ZpZWxkXVsnZGVmYXVsdCddKSB7XG4gICAgICAgIHRoaXMuZGF0YVtmaWVsZF0gPSBbZm9ybS5maWVsZHNbZmllbGRdWydkZWZhdWx0J11dO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHNldChmaWVsZDogc3RyaW5nLCB2YWx1ZTogYW55KTogU2VhcmNoRm9ybSB7XG4gICAgY29uc3QgZmllbGREZXNjID0gdGhpcy5mb3JtLmZpZWxkc1tmaWVsZF07XG4gICAgaWYgKCFmaWVsZERlc2MpIHRocm93IG5ldyBFcnJvcignVW5rbm93biBmaWVsZCAnICsgZmllbGQpO1xuICAgIGNvbnN0IGNoZWNrZWRWYWx1ZSA9IHZhbHVlID09PSAnJyB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHZhbHVlO1xuICAgIGxldCB2YWx1ZXMgPSB0aGlzLmRhdGFbZmllbGRdIHx8IFtdO1xuICAgIGlmIChmaWVsZERlc2MubXVsdGlwbGUpIHtcbiAgICAgIHZhbHVlcyA9IGNoZWNrZWRWYWx1ZSA/IHZhbHVlcy5jb25jYXQoW2NoZWNrZWRWYWx1ZV0pIDogdmFsdWVzO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YWx1ZXMgPSBjaGVja2VkVmFsdWUgPyBbY2hlY2tlZFZhbHVlXSA6IHZhbHVlcztcbiAgICB9XG4gICAgdGhpcy5kYXRhW2ZpZWxkXSA9IHZhbHVlcztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIGEgcmVmIHRvIHF1ZXJ5IG9uIGZvciB0aGlzIFNlYXJjaEZvcm0uIFRoaXMgaXMgYSBtYW5kYXRvcnlcbiAgICogbWV0aG9kIHRvIGNhbGwgYmVmb3JlIGNhbGxpbmcgc3VibWl0KCksIGFuZCBhcGkuZm9ybSgnZXZlcnl0aGluZycpLnN1Ym1pdCgpXG4gICAqIHdpbGwgbm90IHdvcmsuXG4gICAqL1xuICByZWYocmVmOiBzdHJpbmcpOiBTZWFyY2hGb3JtIHtcbiAgICByZXR1cm4gdGhpcy5zZXQoXCJyZWZcIiwgcmVmKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIGEgcHJlZGljYXRlLWJhc2VkIHF1ZXJ5IGZvciB0aGlzIFNlYXJjaEZvcm0uIFRoaXMgaXMgd2hlcmUgeW91XG4gICAqIHBhc3RlIHdoYXQgeW91IGNvbXBvc2UgaW4geW91ciBwcmlzbWljLmlvIEFQSSBicm93c2VyLlxuICAgKi9cbiAgcXVlcnkocXVlcnk6IHN0cmluZyB8IHN0cmluZ1tdKTogU2VhcmNoRm9ybSB7XG4gICAgaWYgKHR5cGVvZiBxdWVyeSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiB0aGlzLnF1ZXJ5KFtxdWVyeV0pO1xuICAgIH0gZWxzZSBpZihxdWVyeSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXQoXCJxXCIsIChgWyR7cXVlcnkuam9pbihcIlwiKX1dYCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgcXVlcnkgOiAke3F1ZXJ5fWApXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgYSBwYWdlIHNpemUgdG8gcXVlcnkgZm9yIHRoaXMgU2VhcmNoRm9ybS4gVGhpcyBpcyBhbiBvcHRpb25hbCBtZXRob2QuXG4gICAqXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBzaXplIC0gVGhlIHBhZ2Ugc2l6ZVxuICAgKiBAcmV0dXJucyB7U2VhcmNoRm9ybX0gLSBUaGUgU2VhcmNoRm9ybSBpdHNlbGZcbiAgICovXG4gIHBhZ2VTaXplKHNpemU6IG51bWJlcik6IFNlYXJjaEZvcm0ge1xuICAgIHJldHVybiB0aGlzLnNldChcInBhZ2VTaXplXCIsIHNpemUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RyaWN0IHRoZSByZXN1bHRzIGRvY3VtZW50IHRvIHRoZSBzcGVjaWZpZWQgZmllbGRzXG4gICAqL1xuICBmZXRjaChmaWVsZHM6IHN0cmluZyB8IHN0cmluZ1tdKTogU2VhcmNoRm9ybSB7XG4gICAgY29uc3Qgc3RyRmllbGRzID0gZmllbGRzIGluc3RhbmNlb2YgQXJyYXkgPyBmaWVsZHMuam9pbihcIixcIikgOiBmaWVsZHM7XG4gICAgcmV0dXJuIHRoaXMuc2V0KFwiZmV0Y2hcIiwgc3RyRmllbGRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbmNsdWRlIHRoZSByZXF1ZXN0ZWQgZmllbGRzIGluIHRoZSBEb2N1bWVudExpbmsgaW5zdGFuY2VzIGluIHRoZSByZXN1bHRcbiAgICovXG4gIGZldGNoTGlua3MoZmllbGRzOiBzdHJpbmcgfCBzdHJpbmdbXSk6IFNlYXJjaEZvcm0ge1xuICAgIGNvbnN0IHN0ckZpZWxkcyA9IGZpZWxkcyBpbnN0YW5jZW9mIEFycmF5ID8gZmllbGRzLmpvaW4oXCIsXCIpIDogZmllbGRzO1xuICAgIHJldHVybiB0aGlzLnNldChcImZldGNoTGlua3NcIiwgc3RyRmllbGRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBsYW5ndWFnZSB0byBxdWVyeSBmb3IgdGhpcyBTZWFyY2hGb3JtLiBUaGlzIGlzIGFuIG9wdGlvbmFsIG1ldGhvZC5cbiAgICovXG4gIGxhbmcobGFuZ0NvZGU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnNldChcImxhbmdcIiwgbGFuZ0NvZGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHBhZ2UgbnVtYmVyIHRvIHF1ZXJ5IGZvciB0aGlzIFNlYXJjaEZvcm0uIFRoaXMgaXMgYW4gb3B0aW9uYWwgbWV0aG9kLlxuICAgKi9cbiAgcGFnZShwOiBudW1iZXIpOiBTZWFyY2hGb3JtIHtcbiAgICByZXR1cm4gdGhpcy5zZXQoXCJwYWdlXCIsIHApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhbGwgdGhlIGRvY3VtZW50cyBleGNlcHQgZm9yIHRob3NlIGFmdGVyIHRoZSBzcGVjaWZpZWQgZG9jdW1lbnQgaW4gdGhlIGxpc3QuIFRoaXMgaXMgYW4gb3B0aW9uYWwgbWV0aG9kLlxuICAgKi9cbiAgYWZ0ZXIoZG9jdW1lbnRJZDogc3RyaW5nKTogU2VhcmNoRm9ybSB7XG4gICAgcmV0dXJuIHRoaXMuc2V0KFwiYWZ0ZXJcIiwgZG9jdW1lbnRJZCk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgb3JkZXJpbmdzIHRvIHF1ZXJ5IGZvciB0aGlzIFNlYXJjaEZvcm0uIFRoaXMgaXMgYW4gb3B0aW9uYWwgbWV0aG9kLlxuICAgKi9cbiAgb3JkZXJpbmdzKG9yZGVyaW5ncyA/OiBzdHJpbmdbXSk6IFNlYXJjaEZvcm0ge1xuICAgIGlmICghb3JkZXJpbmdzKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0KFwib3JkZXJpbmdzXCIsIGBbJHtvcmRlcmluZ3Muam9pbihcIixcIil9XWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZCB0aGUgVVJMIHRvIHF1ZXJ5XG4gICAqL1xuICB1cmwoKTogc3RyaW5nIHtcbiAgICBsZXQgdXJsID0gdGhpcy5mb3JtLmFjdGlvbjtcbiAgICBpZiAodGhpcy5kYXRhKSB7XG4gICAgICBsZXQgc2VwID0gKHVybC5pbmRleE9mKCc/JykgPiAtMSA/ICcmJyA6ICc/Jyk7XG4gICAgICBmb3IoY29uc3Qga2V5IGluIHRoaXMuZGF0YSkge1xuICAgICAgICBpZiAodGhpcy5kYXRhLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICBjb25zdCB2YWx1ZXMgPSB0aGlzLmRhdGFba2V5XTtcbiAgICAgICAgICBpZiAodmFsdWVzKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICB1cmwgKz0gc2VwICsga2V5ICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlc1tpXSk7XG4gICAgICAgICAgICAgIHNlcCA9ICcmJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHVybDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdWJtaXRzIHRoZSBxdWVyeSwgYW5kIGNhbGxzIHRoZSBjYWxsYmFjayBmdW5jdGlvbi5cbiAgICovXG4gIHN1Ym1pdChjYWxsYmFjazogKGVycm9yOiBFcnJvciB8IG51bGwsIHJlc3BvbnNlOiBBcGlSZXNwb25zZSwgeGhyOiBhbnkpID0+IHZvaWQpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLmFwaS5yZXF1ZXN0KHRoaXMudXJsKCksIGNhbGxiYWNrKTtcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFwaVJlc3BvbnNlIHtcbiAgcGFnZTogbnVtYmVyO1xuICByZXN1bHRzX3Blcl9wYWdlOiBudW1iZXI7XG4gIHJlc3VsdHNfc2l6ZTogbnVtYmVyO1xuICB0b3RhbF9yZXN1bHRzX3NpemU6IG51bWJlcjtcbiAgdG90YWxfcGFnZXM6IG51bWJlcjtcbiAgbmV4dF9wYWdlOiBzdHJpbmc7XG4gIHByZXZfcGFnZTogc3RyaW5nO1xuICByZXN1bHRzOiBEb2N1bWVudFtdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFwaU9wdGlvbnMge1xuICBhY2Nlc3NUb2tlbj86IHN0cmluZztcbiAgY29tcGxldGU/OiAoZXJyOiBFcnJvciB8IG51bGwsIHZhbHVlPzogYW55LCB4aHI/OiBhbnkpID0+IHZvaWQ7XG4gIHJlcXVlc3RIYW5kbGVyPzogUmVxdWVzdEhhbmRsZXI7XG4gIHJlcT86IGFueTtcbiAgYXBpQ2FjaGU/OiBBcGlDYWNoZTtcbiAgYXBpRGF0YVRUTD86IG51bWJlcjtcbiAgcHJveHlBZ2VudD86IGFueTtcbn1cblxuZXhwb3J0IGNsYXNzIEFwaSB7XG4gIHVybDogc3RyaW5nO1xuICBhY2Nlc3NUb2tlbj86IHN0cmluZztcbiAgcmVxOiBhbnk7XG4gIGFwaUNhY2hlS2V5OiBzdHJpbmc7XG4gIGFwaUNhY2hlOiBBcGlDYWNoZTtcbiAgYXBpRGF0YVRUTDogbnVtYmVyO1xuICByZXF1ZXN0SGFuZGxlcjogUmVxdWVzdEhhbmRsZXI7XG4gIGV4cGVyaW1lbnRzOiBFeHBlcmltZW50cztcbiAgYm9va21hcmtzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9O1xuICByZWZzOiBSZWZbXTtcbiAgdHlwZXM6IG9iamVjdDtcbiAgdGFnczogc3RyaW5nW107XG4gIGRhdGE6IGFueTtcbiAgZm9ybXM6IEZvcm1bXTtcbiAgb2F1dGhJbml0aWF0ZTogc3RyaW5nO1xuICBvYXV0aFRva2VuOiBzdHJpbmc7XG4gIHF1aWNrUm91dGVzOiBhbnk7XG5cbiAgY29uc3RydWN0b3IodXJsOiBzdHJpbmcsIG9wdGlvbnM6IEFwaU9wdGlvbnMpIHtcbiAgICBjb25zdCBvcHRzOiBBcGlPcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICB0aGlzLmFjY2Vzc1Rva2VuID0gb3B0cy5hY2Nlc3NUb2tlbjtcbiAgICB0aGlzLnVybCA9IHVybCArICh0aGlzLmFjY2Vzc1Rva2VuID8gKHVybC5pbmRleE9mKCc/JykgPiAtMSA/ICcmJyA6ICc/JykgKyAnYWNjZXNzX3Rva2VuPScgKyB0aGlzLmFjY2Vzc1Rva2VuIDogJycpO1xuICAgIHRoaXMucmVxID0gb3B0cy5yZXE7XG4gICAgdGhpcy5hcGlDYWNoZSA9IG9wdHMuYXBpQ2FjaGUgfHwgbmV3IERlZmF1bHRBcGlDYWNoZSgpO1xuICAgIHRoaXMucmVxdWVzdEhhbmRsZXIgPSBvcHRzLnJlcXVlc3RIYW5kbGVyIHx8IG5ldyBEZWZhdWx0UmVxdWVzdEhhbmRsZXIoeyBwcm94eUFnZW50OiBvcHRzLnByb3h5QWdlbnQgfSk7XG4gICAgdGhpcy5hcGlDYWNoZUtleSA9IHRoaXMudXJsICsgKHRoaXMuYWNjZXNzVG9rZW4gPyAoJyMnICsgdGhpcy5hY2Nlc3NUb2tlbikgOiAnJyk7XG4gICAgdGhpcy5hcGlEYXRhVFRMID0gb3B0cy5hcGlEYXRhVFRMIHx8IDU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgLyoqXG4gICAqIEZldGNoZXMgZGF0YSB1c2VkIHRvIGNvbnN0cnVjdCB0aGUgYXBpIGNsaWVudCwgZnJvbSBjYWNoZSBpZiBpdCdzXG4gICAqIHByZXNlbnQsIG90aGVyd2lzZSBmcm9tIGNhbGxpbmcgdGhlIHByaXNtaWMgYXBpIGVuZHBvaW50ICh3aGljaCBpc1xuICAgKiB0aGVuIGNhY2hlZCkuXG4gICAqL1xuICBnZXQoY2FsbGJhY2s6IChlcnI6IEVycm9yIHwgbnVsbCwgdmFsdWU/OiBhbnksIHhocj86IGFueSwgdHRsPzogbnVtYmVyKSA9PiB2b2lkKTogUHJvbWlzZTxBcGk+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IHRoaXMuYXBpQ2FjaGVLZXk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgY2IgPSAoZXJyOiBFcnJvciB8IG51bGwsIHZhbHVlPzogYW55LCB4aHI/OiBhbnksIHR0bD86IG51bWJlcikgPT4ge1xuICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKGVyciwgdmFsdWUsIHhociwgdHRsKTtcbiAgICAgICAgaWYgKHZhbHVlKSByZXNvbHZlKHZhbHVlKTtcbiAgICAgICAgaWYgKGVycikgcmVqZWN0KGVycik7XG4gICAgICB9O1xuICAgICAgdGhpcy5hcGlDYWNoZS5nZXQoY2FjaGVLZXksIChlcnI6IEVycm9yIHwgbnVsbCwgdmFsdWU/OiBhbnkpID0+IHtcbiAgICAgICAgaWYgKGVyciB8fCB2YWx1ZSkge1xuICAgICAgICAgIGNiKGVyciwgdmFsdWUpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVxdWVzdEhhbmRsZXIucmVxdWVzdCh0aGlzLnVybCwgKGVycjogRXJyb3IgfCBudWxsLCB2YWx1ZT86IGFueSwgeGhyPzogYW55LCB0dGw/OiBudW1iZXIpID0+IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBjYihlcnIsIG51bGwsIHhociwgdHRsKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgcGFyc2VkID0gdGhpcy5wYXJzZSh2YWx1ZSk7XG5cbiAgICAgICAgICB0dGwgPSB0dGwgfHwgdGhpcy5hcGlEYXRhVFRMO1xuXG4gICAgICAgICAgdGhpcy5hcGlDYWNoZS5zZXQoY2FjaGVLZXksIHBhcnNlZCwgdHRsLCAoZXJyOiBFcnJvcikgPT4ge1xuICAgICAgICAgICAgY2IoZXJyLCBwYXJzZWQsIHhociwgdHRsKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbnMgYXBpIGRhdGEgZnJvbSB0aGUgY2FjaGUgYW5kIGZldGNoZXMgYW4gdXAgdG8gZGF0ZSBjb3B5LlxuICAgKlxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAtIE9wdGlvbmFsIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIGFmdGVyIHRoZSBkYXRhIGhhcyBiZWVuIHJlZnJlc2hlZFxuICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICovXG4gIHJlZnJlc2goY2FsbGJhY2s6IChlcnI6IEVycm9yIHwgbnVsbCB8IHVuZGVmaW5lZCwgZGF0YTogYW55LCB4aHI6IGFueSkgPT4gdm9pZCk6IFByb21pc2VMaWtlPEFwaVJlc3BvbnNlPiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSB0aGlzLmFwaUNhY2hlS2V5O1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgY29uc3QgY2IgPSAoZXJyPzogRXJyb3IgfCBudWxsLCB2YWx1ZT86IGFueSwgeGhyPzogYW55KSA9PiB7XG4gICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soZXJyLCB2YWx1ZSwgeGhyKTtcbiAgICAgICAgaWYgKHZhbHVlKSByZXNvbHZlKHZhbHVlKTtcbiAgICAgICAgaWYgKGVycikgcmVqZWN0KGVycik7XG4gICAgICB9O1xuICAgICAgdGhpcy5hcGlDYWNoZS5yZW1vdmUoY2FjaGVLZXksIChlcnI6IEVycm9yKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHsgY2IoZXJyKTsgcmV0dXJuOyB9XG5cbiAgICAgICAgdGhpcy5nZXQoKGVycjogRXJyb3IsIGRhdGE6IGFueSkgPT4ge1xuICAgICAgICAgIGlmIChlcnIpIHsgY2IoZXJyKTsgcmV0dXJuOyB9XG5cbiAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgICAgICAgIHRoaXMuYm9va21hcmtzID0gZGF0YS5ib29rbWFya3M7XG4gICAgICAgICAgdGhpcy5leHBlcmltZW50cyA9IG5ldyBFeHBlcmltZW50cyhkYXRhLmV4cGVyaW1lbnRzKTtcblxuICAgICAgICAgIGNiKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUGFyc2VzIGFuZCByZXR1cm5zIHRoZSAvYXBpIGRvY3VtZW50LlxuICAgKiBUaGlzIGlzIGZvciBpbnRlcm5hbCB1c2UsIGZyb20gb3V0c2lkZSB0aGlzIGtpdCwgeW91IHNob3VsZCBjYWxsIFByaXNtaWMuQXBpKClcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGEgLSBUaGUgSlNPTiBkb2N1bWVudCByZXNwb25kZWQgb24gdGhlIEFQSSdzIGVuZHBvaW50XG4gICAqIEByZXR1cm5zIHtBcGl9IC0gVGhlIEFwaSBvYmplY3QgdGhhdCBjYW4gYmUgbWFuaXB1bGF0ZWRcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHBhcnNlKGRhdGE6IGFueSk6IG9iamVjdCB7XG4gICAgLy8gUGFyc2UgdGhlIGZvcm1zXG4gICAgY29uc3QgZm9ybXMgPSBPYmplY3Qua2V5cyhkYXRhLmZvcm1zIHx8IFtdKS5yZWR1Y2UoKGFjYzogYW55LCBrZXk6IHN0cmluZywgaTogbnVtYmVyKSA9PiB7XG4gICAgICBpZiAoZGF0YS5mb3Jtcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgIGNvbnN0IGZvcm0gPSBkYXRhLmZvcm1zW2tleV0gYXMgRm9ybTtcblxuICAgICAgICBpZih0aGlzLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgZm9ybS5maWVsZHNbJ2FjY2Vzc190b2tlbiddID0ge307XG4gICAgICAgICAgZm9ybS5maWVsZHNbJ2FjY2Vzc190b2tlbiddWyd0eXBlJ10gPSAnc3RyaW5nJztcbiAgICAgICAgICBmb3JtLmZpZWxkc1snYWNjZXNzX3Rva2VuJ11bJ2RlZmF1bHQnXSA9IHRoaXMuYWNjZXNzVG9rZW47XG4gICAgICAgIH1cblxuICAgICAgICBhY2Nba2V5XSA9IGZvcm07XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgfVxuICAgIH0sIHt9KTtcblxuICAgIGNvbnN0IHJlZnM6IFJlZltdID0gZGF0YS5yZWZzIHx8IFtdO1xuXG4gICAgY29uc3QgbWFzdGVyID0gcmVmcy5maWx0ZXIociA9PiByLmlzTWFzdGVyUmVmKVswXTtcblxuICAgIGNvbnN0IHR5cGVzID0gZGF0YS50eXBlcztcblxuICAgIGNvbnN0IHRhZ3MgPSBkYXRhLnRhZ3M7XG5cbiAgICBpZiAoIW1hc3Rlcikge1xuICAgICAgdGhyb3cgKFwiTm8gbWFzdGVyIHJlZi5cIik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGJvb2ttYXJrczogZGF0YS5ib29rbWFya3MgfHwge30sXG4gICAgICByZWZzLFxuICAgICAgZm9ybXMsXG4gICAgICBtYXN0ZXIsXG4gICAgICB0eXBlczogdHlwZXMsXG4gICAgICB0YWdzLFxuICAgICAgZXhwZXJpbWVudHM6IGRhdGEuZXhwZXJpbWVudHMsXG4gICAgICBvYXV0aEluaXRpYXRlOiBkYXRhWydvYXV0aF9pbml0aWF0ZSddLFxuICAgICAgb2F1dGhUb2tlbjogZGF0YVsnb2F1dGhfdG9rZW4nXSxcbiAgICAgIHF1aWNrUm91dGVzOiBkYXRhLnF1aWNrUm91dGVzXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgdXNlYWJsZSBmb3JtIGZyb20gaXRzIGlkLCBhcyBkZXNjcmliZWQgaW4gdGhlIFJFU1RmdWwgZGVzY3JpcHRpb24gb2YgdGhlIEFQSS5cbiAgICogRm9yIGluc3RhbmNlOiBhcGkuZm9ybShcImV2ZXJ5dGhpbmdcIikgd29ya3Mgb24gZXZlcnkgcmVwb3NpdG9yeSAoYXMgXCJldmVyeXRoaW5nXCIgZXhpc3RzIGJ5IGRlZmF1bHQpXG4gICAqIFlvdSBjYW4gdGhlbiBjaGFpbiB0aGUgY2FsbHM6IGFwaS5mb3JtKFwiZXZlcnl0aGluZ1wiKS5xdWVyeSgnW1s6ZCA9IGF0KGRvY3VtZW50LmlkLCBcIlVrTDBnTXV2ellVQU5DcGZcIildXScpLnJlZihyZWYpLnN1Ym1pdCgpXG4gICAqL1xuICBmb3JtKGZvcm1JZDogc3RyaW5nKTogU2VhcmNoRm9ybSB8IG51bGwge1xuICAgIHZhciBmb3JtID0gdGhpcy5kYXRhLmZvcm1zW2Zvcm1JZF07XG4gICAgaWYoZm9ybSkge1xuICAgICAgcmV0dXJuIG5ldyBTZWFyY2hGb3JtKHRoaXMsIGZvcm0sIHt9KTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBldmVyeXRoaW5nKCk6IFNlYXJjaEZvcm0ge1xuICAgIGNvbnN0IGYgPSB0aGlzLmZvcm0oXCJldmVyeXRoaW5nXCIpO1xuICAgIGlmKCFmKSB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIGV2ZXJ5dGhpbmcgZm9ybVwiKTtcbiAgICByZXR1cm4gZjtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIG1hc3RlciByZWYgb24gdGhpcyBwcmlzbWljLmlvIEFQSS5cbiAgICogRG8gbm90IHVzZSBsaWtlIHRoaXM6IHNlYXJjaEZvcm0ucmVmKGFwaS5tYXN0ZXIoKSkuXG4gICAqIEluc3RlYWQsIHNldCB5b3VyIHJlZiBvbmNlIGluIGEgdmFyaWFibGUsIGFuZCBjYWxsIGl0IHdoZW4geW91IG5lZWQgaXQ7IHRoaXMgd2lsbCBhbGxvdyB0byBjaGFuZ2UgdGhlIHJlZiB5b3UncmUgdmlld2luZyBlYXNpbHkgZm9yIHlvdXIgZW50aXJlIHBhZ2UuXG4gICAqL1xuICBtYXN0ZXIoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLm1hc3Rlci5yZWY7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgcmVmIElEIGZvciBhIGdpdmVuIHJlZidzIGxhYmVsLlxuICAgKiBEbyBub3QgdXNlIGxpa2UgdGhpczogc2VhcmNoRm9ybS5yZWYoYXBpLnJlZihcIkZ1dHVyZSByZWxlYXNlIGxhYmVsXCIpKS5cbiAgICogSW5zdGVhZCwgc2V0IHlvdXIgcmVmIG9uY2UgaW4gYSB2YXJpYWJsZSwgYW5kIGNhbGwgaXQgd2hlbiB5b3UgbmVlZCBpdDsgdGhpcyB3aWxsIGFsbG93IHRvIGNoYW5nZSB0aGUgcmVmIHlvdSdyZSB2aWV3aW5nIGVhc2lseSBmb3IgeW91ciBlbnRpcmUgcGFnZS5cbiAgICovXG4gIHJlZihsYWJlbDogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgZm9yKHZhciBpPTA7IGk8dGhpcy5kYXRhLnJlZnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmKHRoaXMuZGF0YS5yZWZzW2ldLmxhYmVsID09IGxhYmVsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEucmVmc1tpXS5yZWY7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBjdXJyZW50IGV4cGVyaW1lbnQsIG9yIG51bGxcbiAgICovXG4gIGN1cnJlbnRFeHBlcmltZW50KCk6IEV4cGVyaW1lbnQgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5leHBlcmltZW50cy5jdXJyZW50KCk7XG4gIH1cblxuICBxdWlja1JvdXRlc0VuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YS5xdWlja1JvdXRlcy5lbmFibGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHF1aWNrIHJvdXRlcyBkZWZpbml0aW9uc1xuICAgKi9cbiAgZ2V0UXVpY2tSb3V0ZXMoY2FsbGJhY2s6IChlcnI6IEVycm9yLCBkYXRhOiBhbnksIHhocjogYW55KSA9PiB2b2lkKTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5yZXF1ZXN0SGFuZGxlci5yZXF1ZXN0KHRoaXMuZGF0YS5xdWlja1JvdXRlcy51cmwsIChlcnI6IEVycm9yLCBkYXRhOiBhbnksIHhocjogYW55KSA9PiB7XG4gICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soZXJyLCBkYXRhLCB4aHIpO1xuICAgICAgICBpZiAoZXJyKSByZWplY3QoZXJyKTtcbiAgICAgICAgaWYgKGRhdGEpIHJlc29sdmUoZGF0YSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBRdWVyeSB0aGUgcmVwb3NpdG9yeVxuICAgKi9cbiAgcXVlcnkocTogc3RyaW5nIHwgc3RyaW5nW10sIG9wdGlvbnNPckNhbGxiYWNrOiBvYmplY3QgfCAoKGVycjogRXJyb3IgfCBudWxsLCByZXNwb25zZT86IGFueSkgPT4gdm9pZCksIGNiOiAoZXJyOiBFcnJvciB8IG51bGwsIHJlc3BvbnNlPzogYW55KSA9PiB2b2lkKTogUHJvbWlzZTxBcGlSZXNwb25zZT4ge1xuICAgICAgICBjb25zdCB7b3B0aW9ucywgY2FsbGJhY2t9ID0gdHlwZW9mIG9wdGlvbnNPckNhbGxiYWNrID09PSAnZnVuY3Rpb24nXG4gICAgICA/IHtvcHRpb25zOiB7fSwgY2FsbGJhY2s6IG9wdGlvbnNPckNhbGxiYWNrfVxuICAgICAgOiB7b3B0aW9uczogb3B0aW9uc09yQ2FsbGJhY2sgfHwge30sIGNhbGxiYWNrOiBjYn07XG5cbiAgICBjb25zdCBvcHRzOiBhbnkgPSBvcHRpb25zO1xuXG4gICAgdmFyIGZvcm0gPSB0aGlzLmV2ZXJ5dGhpbmcoKTtcbiAgICBmb3IgKHZhciBrZXkgaW4gb3B0cykge1xuICAgICAgZm9ybSA9IGZvcm0uc2V0KGtleSwgb3B0c1trZXldKTtcbiAgICB9XG4gICAgaWYgKCFvcHRzWydyZWYnXSkge1xuICAgICAgLy8gTG9vayBpbiBjb29raWVzIGlmIHdlIGhhdmUgYSByZWYgKHByZXZpZXcgb3IgZXhwZXJpbWVudClcbiAgICAgIHZhciBjb29raWVTdHJpbmcgPSAnJztcbiAgICAgIGlmICh0aGlzLnJlcSkgeyAvLyBOb2RlSlNcbiAgICAgICAgY29va2llU3RyaW5nID0gdGhpcy5yZXEuaGVhZGVyc1tcImNvb2tpZVwiXSB8fCAnJztcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LmRvY3VtZW50KSB7IC8vIEJyb3dzZXJcbiAgICAgICAgY29va2llU3RyaW5nID0gd2luZG93LmRvY3VtZW50LmNvb2tpZSB8fCAnJztcbiAgICAgIH1cbiAgICAgIHZhciBjb29raWVzID0gQ29va2llcy5wYXJzZShjb29raWVTdHJpbmcpO1xuICAgICAgdmFyIHByZXZpZXdSZWYgPSBjb29raWVzW1ByZXZpZXdDb29raWVdO1xuICAgICAgdmFyIGV4cGVyaW1lbnRSZWYgPSB0aGlzLmV4cGVyaW1lbnRzLnJlZkZyb21Db29raWUoY29va2llc1tFeHBlcmltZW50Q29va2llXSk7XG4gICAgICBmb3JtID0gZm9ybS5yZWYocHJldmlld1JlZiB8fCBleHBlcmltZW50UmVmIHx8IHRoaXMubWFzdGVyKCkpO1xuICAgIH1cbiAgICBpZiAocSkge1xuICAgICAgZm9ybS5xdWVyeShxKTtcbiAgICB9XG4gICAgcmV0dXJuIGZvcm0uc3VibWl0KGNhbGxiYWNrKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgZG9jdW1lbnQgcmV0dXJuZWQgYnkgdGhlIGdpdmVuIHF1ZXJ5XG4gICAqIEBwYXJhbSB7c3RyaW5nfGFycmF5fFByZWRpY2F0ZX0gdGhlIHF1ZXJ5XG4gICAqIEBwYXJhbSB7b2JqZWN0fSBhZGRpdGlvbmFsIHBhcmFtZXRlcnMuIEluIE5vZGVKUywgcGFzcyB0aGUgcmVxdWVzdCBhcyAncmVxJy5cbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2soZXJyLCBkb2MpXG4gICAqL1xuICBxdWVyeUZpcnN0KHE6IHN0cmluZyB8IHN0cmluZ1tdLCBvcHRpb25zT3JDYWxsYmFjazogb2JqZWN0IHwgKChlcnI6IEVycm9yIHwgbnVsbCwgcmVzcG9uc2U/OiBhbnkpID0+IHZvaWQpLCBjYjogKGVycjogRXJyb3IgfCBudWxsLCByZXNwb25zZT86IGFueSkgPT4gdm9pZCkge1xuICAgIGNvbnN0IHtvcHRpb25zLCBjYWxsYmFja30gPSB0eXBlb2Ygb3B0aW9uc09yQ2FsbGJhY2sgPT09ICdmdW5jdGlvbidcbiAgICAgID8ge29wdGlvbnM6IHt9LCBjYWxsYmFjazogb3B0aW9uc09yQ2FsbGJhY2t9XG4gICAgICA6IHtvcHRpb25zOiBvcHRpb25zT3JDYWxsYmFjayB8fCB7fSwgY2FsbGJhY2s6IGNifTtcblxuICAgIGNvbnN0IG9wdHM6IGFueSA9IG9wdGlvbnM7XG4gICAgb3B0cy5wYWdlID0gMTtcbiAgICBvcHRzLnBhZ2VTaXplID0gMTtcbiAgICByZXR1cm4gdGhpcy5xdWVyeShxLCBvcHRzLCBmdW5jdGlvbihlcnI6IEVycm9yLCByZXNwb25zZTogYW55KSB7XG4gICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHJlc3BvbnNlICYmIHJlc3BvbnNlLnJlc3VsdHMgJiYgcmVzcG9uc2UucmVzdWx0c1swXTtcbiAgICAgICAgY2FsbGJhY2soZXJyLCByZXN1bHQpO1xuICAgICAgfVxuICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2U6IGFueSl7XG4gICAgICByZXR1cm4gcmVzcG9uc2UgJiYgcmVzcG9uc2UucmVzdWx0cyAmJiByZXNwb25zZS5yZXN1bHRzWzBdO1xuICAgIH0pLmNhdGNoKChlOiBFcnJvcikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGRvY3VtZW50IHdpdGggdGhlIGdpdmVuIGlkXG4gICAqL1xuICBnZXRCeUlEKGlkOiBzdHJpbmcsIG9wdGlvbnM6IGFueSwgY2FsbGJhY2s6IChlcnI6IEVycm9yIHwgbnVsbCwgcmVzcG9uc2U/OiBhbnkpID0+IHZvaWQpIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBpZighb3B0aW9ucy5sYW5nKSBvcHRpb25zLmxhbmcgPSAnKic7XG4gICAgcmV0dXJuIHRoaXMucXVlcnlGaXJzdChQcmVkaWNhdGVzLmF0KCdkb2N1bWVudC5pZCcsIGlkKSwgb3B0aW9ucywgY2FsbGJhY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIG11bHRpcGxlIGRvY3VtZW50cyBmcm9tIGFuIGFycmF5IG9mIGlkXG4gICAqL1xuICBnZXRCeUlEcyhpZHM6IHN0cmluZ1tdLCBvcHRpb25zOiBhbnksIGNhbGxiYWNrOiAoZXJyOiBFcnJvciB8IG51bGwsIHJlc3BvbnNlPzogYW55KSA9PiB2b2lkKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgaWYoIW9wdGlvbnMubGFuZykgb3B0aW9ucy5sYW5nID0gJyonO1xuICAgIHJldHVybiB0aGlzLnF1ZXJ5KFByZWRpY2F0ZXMuaW4oJ2RvY3VtZW50LmlkJywgaWRzKSwgb3B0aW9ucywgY2FsbGJhY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBkb2N1bWVudCB3aXRoIHRoZSBnaXZlbiB1aWRcbiAgICovXG4gIGdldEJ5VUlEKHR5cGU6IHN0cmluZywgdWlkOiBzdHJpbmcsIG9wdGlvbnM6IGFueSwgY2FsbGJhY2s6IChlcnI6IEVycm9yIHwgbnVsbCwgcmVzcG9uc2U/OiBhbnkpID0+IHZvaWQpIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBpZighb3B0aW9ucy5sYW5nKSBvcHRpb25zLmxhbmcgPSAnKic7XG4gICAgcmV0dXJuIHRoaXMucXVlcnlGaXJzdChQcmVkaWNhdGVzLmF0KGBteS4ke3R5cGV9LnVpZGAsIHVpZCksIG9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgc2luZ2xldG9uIGRvY3VtZW50IHdpdGggdGhlIGdpdmVuIHR5cGVcbiAgICovXG4gIGdldFNpbmdsZSh0eXBlOiBzdHJpbmcsIG9wdGlvbnM6IGFueSwgY2FsbGJhY2s6IChlcnI6IEVycm9yIHwgbnVsbCwgcmVzcG9uc2U/OiBhbnkpID0+IHZvaWQpIHtcbiAgICByZXR1cm4gdGhpcy5xdWVyeUZpcnN0KFByZWRpY2F0ZXMuYXQoJ2RvY3VtZW50LnR5cGUnLCB0eXBlKSwgb3B0aW9ucywgY2FsbGJhY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBkb2N1bWVudCB3aXRoIHRoZSBnaXZlbiBib29rbWFya1xuICAgKi9cbiAgZ2V0Qm9va21hcmsoYm9va21hcms6IHN0cmluZywgb3B0aW9uczogYW55LCBjYWxsYmFjazogKGVycjogRXJyb3IgfCBudWxsLCByZXNwb25zZT86IGFueSkgPT4gdm9pZCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5ib29rbWFya3NbYm9va21hcmtdO1xuICAgICAgaWYgKGlkKSB7XG4gICAgICAgIHJlc29sdmUoaWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKFwiRXJyb3IgcmV0cmlldmluZyBib29rbWFya2VkIGlkXCIpO1xuICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKGVycik7XG4gICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgfVxuICAgIH0pLnRoZW4oaWQgPT4gdGhpcy5nZXRCeUlEKGlkLCBvcHRpb25zLCBjYWxsYmFjaykpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgVVJMIHRvIGRpc3BsYXkgYSBnaXZlbiBwcmV2aWV3XG4gICAqL1xuICBwcmV2aWV3U2Vzc2lvbih0b2tlbjogc3RyaW5nLCBsaW5rUmVzb2x2ZXI6IChjdHg6IGFueSkgPT4gc3RyaW5nLCBkZWZhdWx0VXJsOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyOiBFcnJvciB8IG51bGwsIHVybD86IGFueSwgeGhyPzogYW55KSA9PiB2b2lkKTogUHJvbWlzZUxpa2U8c3RyaW5nPiB7XG4gICAgdmFyIGFwaSA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIGNiID0gZnVuY3Rpb24oZXJyOiBFcnJvciB8IG51bGwsIHVybD86IHN0cmluZywgeGhyPzogYW55KSB7XG4gICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soZXJyLCB1cmwsIHhocik7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKHVybCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBhcGkucmVxdWVzdEhhbmRsZXIucmVxdWVzdCh0b2tlbiwgZnVuY3Rpb24oZXJyOiBFcnJvciwgcmVzdWx0OiBhbnksIHhocjogYW55KSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBjYihlcnIsIGRlZmF1bHRVcmwsIHhocik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFyIG1haW5Eb2N1bWVudElkID0gcmVzdWx0Lm1haW5Eb2N1bWVudDtcbiAgICAgICAgICBpZiAoIW1haW5Eb2N1bWVudElkKSB7XG4gICAgICAgICAgICBjYihudWxsLCBkZWZhdWx0VXJsLCB4aHIpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhcGkuZXZlcnl0aGluZygpLnF1ZXJ5KFByZWRpY2F0ZXMuYXQoXCJkb2N1bWVudC5pZFwiLCBtYWluRG9jdW1lbnRJZCkpLnJlZih0b2tlbikubGFuZygnKicpLnN1Ym1pdChmdW5jdGlvbihlcnI6IEVycm9yLCByZXNwb25zZTogQXBpUmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGNiKGVycik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UucmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgIGNiKG51bGwsIGRlZmF1bHRVcmwsIHhocik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGNiKG51bGwsIGxpbmtSZXNvbHZlcihyZXNwb25zZS5yZXN1bHRzWzBdKSwgeGhyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjYihlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY2IoZSwgZGVmYXVsdFVybCwgeGhyKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYSBVUkwgY29ycmVzcG9uZGluZyB0byBhIHF1ZXJ5LCBhbmQgcGFyc2UgdGhlIHJlc3BvbnNlIGFzIGEgUmVzcG9uc2Ugb2JqZWN0XG4gICAqL1xuICByZXF1ZXN0KHVybDogc3RyaW5nLCBjYWxsYmFjazogKGVycjogRXJyb3IgfCBudWxsLCByZXN1bHRzOiBBcGlSZXNwb25zZSB8IG51bGwsIHhocj86IGFueSkgPT4gdm9pZCk6IFByb21pc2VMaWtlPEFwaVJlc3BvbnNlPiB7XG4gICAgdmFyIGFwaSA9IHRoaXM7XG4gICAgdmFyIGNhY2hlS2V5ID0gdXJsICsgKHRoaXMuYWNjZXNzVG9rZW4gPyAoJyMnICsgdGhpcy5hY2Nlc3NUb2tlbikgOiAnJyk7XG4gICAgdmFyIGNhY2hlID0gdGhpcy5hcGlDYWNoZTtcbiAgICBmdW5jdGlvbiBydW4oY2I6IChlcnI6IEVycm9yIHwgbnVsbCwgcmVzdWx0czogQXBpUmVzcG9uc2UgfCBudWxsLCB4aHI/OiBhbnkpID0+IHZvaWQpIHtcbiAgICAgIGNhY2hlLmdldChjYWNoZUtleSwgZnVuY3Rpb24gKGVycjogRXJyb3IsIHZhbHVlOiBhbnkpIHtcbiAgICAgICAgaWYgKGVyciB8fCB2YWx1ZSkge1xuICAgICAgICAgIGNiKGVyciwgdmFsdWUgYXMgQXBpUmVzcG9uc2UpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBhcGkucmVxdWVzdEhhbmRsZXIucmVxdWVzdCh1cmwsIGZ1bmN0aW9uKGVycjogRXJyb3IsIGRvY3VtZW50czogYW55LCB4aHI6IGFueSwgdHRsPzogbnVtYmVyKSB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgY2IoZXJyLCBudWxsLCB4aHIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICh0dGwpIHtcbiAgICAgICAgICAgIGNhY2hlLnNldChjYWNoZUtleSwgZG9jdW1lbnRzLCB0dGwsIGZ1bmN0aW9uIChlcnI6IEVycm9yKSB7XG4gICAgICAgICAgICAgIGNiKGVyciwgZG9jdW1lbnRzIGFzIEFwaVJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYihudWxsLCBkb2N1bWVudHMgYXMgQXBpUmVzcG9uc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcnVuKGZ1bmN0aW9uKGVyciwgdmFsdWUsIHhocikge1xuICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKGVyciwgdmFsdWUsIHhocik7XG4gICAgICAgIGlmIChlcnIpIHJlamVjdChlcnIpO1xuICAgICAgICBpZiAodmFsdWUpIHJlc29sdmUodmFsdWUpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBnZXROZXh0UGFnZShuZXh0UGFnZTogc3RyaW5nLCBjYWxsYmFjazogKGVycjogRXJyb3IgfCBudWxsLCByZXN1bHRzOiBBcGlSZXNwb25zZSB8IG51bGwsIHhocj86IGFueSkgPT4gdm9pZCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QobmV4dFBhZ2UgKyAodGhpcy5hY2Nlc3NUb2tlbiA/ICcmYWNjZXNzX3Rva2VuPScgKyB0aGlzLmFjY2Vzc1Rva2VuIDogJycpLCBjYWxsYmFjayk7XG4gIH1cbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9hcGkudHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUF3QkE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBNUlBO0FBbUtBO0FBbUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7O0FBT0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7O0FBS0E7QUFDQTtBQUNBOztBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBOVpBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///5\n");

/***/ }),
/* 6 */
/*!************************!*\
  !*** ./src/request.ts ***!
  \************************/
/*! no static exports found */
/*! all exports used */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nexports.__esModule = true;\nfunction createError(status, message) {\n    return {\n        message: message,\n        status: status,\n        name: 'prismic-request-error'\n    };\n}\n// Number of maximum simultaneous connections to the prismic server\nvar MAX_CONNECTIONS = 20;\n// Number of requests currently running (capped by MAX_CONNECTIONS)\nvar running = 0;\n// Requests in queue\nvar queue = [];\nfunction fetchRequest(url, onSuccess, onError, options) {\n    var fetchOptions = {\n        headers: {\n            Accept: 'application/json'\n        }\n    };\n    if (options && options.proxyAgent) {\n        fetchOptions.agent = options.proxyAgent;\n    }\n    return fetch(url, fetchOptions).then(function (response) {\n        if (~~(response.status / 100 != 2)) {\n            throw createError(response.status, \"Unexpected status code [\" + response.status + \"] on URL \" + url);\n        }\n        else {\n            return response.json().then(function (json) {\n                return {\n                    response: response,\n                    json: json\n                };\n            });\n        }\n    }).then(function (next) {\n        var response = next.response;\n        var json = next.json;\n        var cacheControl = response.headers.get('cache-control');\n        var parsedCacheControl = cacheControl ? /max-age=(\\d+)/.exec(cacheControl) : null;\n        var ttl = parsedCacheControl ? parseInt(parsedCacheControl[1], 10) : undefined;\n        onSuccess({ result: json, xhr: response, ttl: ttl });\n    })[\"catch\"](function (error) {\n        onError({ error: error });\n    });\n}\nfunction processQueue(options) {\n    if (queue.length === 0 || running >= MAX_CONNECTIONS) {\n        return;\n    }\n    running++;\n    var next = queue.shift();\n    fetchRequest(next.url, function (_a) {\n        var result = _a.result, xhr = _a.xhr, ttl = _a.ttl;\n        running--;\n        next.callback(null, result, xhr, ttl);\n        processQueue(options);\n    }, function (_a) {\n        var error = _a.error;\n        next.callback(error);\n        processQueue(options);\n    }, options);\n}\nvar DefaultRequestHandler = /** @class */ (function () {\n    function DefaultRequestHandler(options) {\n        this.options = options;\n    }\n    DefaultRequestHandler.prototype.request = function (url, cb) {\n        queue.push({\n            url: url,\n            callback: cb\n        });\n        processQueue(this.options);\n    };\n    return DefaultRequestHandler;\n}());\nexports.DefaultRequestHandler = DefaultRequestHandler;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9yZXF1ZXN0LnRzPzliNTAiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGludGVyZmFjZSBSZXF1ZXN0RXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIHN0YXR1czogbnVtYmVyO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVFcnJvcihzdGF0dXM6IG51bWJlciwgbWVzc2FnZTogc3RyaW5nKTogUmVxdWVzdEVycm9yIHtcbiAgcmV0dXJuIHtcbiAgICBtZXNzYWdlLFxuICAgIHN0YXR1cyxcbiAgICBuYW1lOiAncHJpc21pYy1yZXF1ZXN0LWVycm9yJyxcbiAgfTtcbn1cblxuLy8gTnVtYmVyIG9mIG1heGltdW0gc2ltdWx0YW5lb3VzIGNvbm5lY3Rpb25zIHRvIHRoZSBwcmlzbWljIHNlcnZlclxuY29uc3QgTUFYX0NPTk5FQ1RJT05TOiBudW1iZXIgPSAyMDtcbi8vIE51bWJlciBvZiByZXF1ZXN0cyBjdXJyZW50bHkgcnVubmluZyAoY2FwcGVkIGJ5IE1BWF9DT05ORUNUSU9OUylcbmxldCBydW5uaW5nOiBudW1iZXIgPSAwO1xuLy8gUmVxdWVzdHMgaW4gcXVldWVcbmNvbnN0IHF1ZXVlOiBhbnlbXSAgPSBbXTtcblxuaW50ZXJmYWNlIFJlcXVlc3RDYWxsYmFjayB7fVxuXG5pbnRlcmZhY2UgUmVxdWVzdENhbGxiYWNrU3VjY2VzcyBleHRlbmRzIFJlcXVlc3RDYWxsYmFjayB7XG4gIHJlc3VsdDogYW55O1xuICB4aHI6IGFueTtcbiAgdHRsID86IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFJlcXVlc3RDYWxsYmFja0ZhaWx1cmUgZXh0ZW5kcyBSZXF1ZXN0Q2FsbGJhY2sge1xuICBlcnJvcjogRXJyb3Jcbn1cblxuaW50ZXJmYWNlIE5vZGVSZXF1ZXN0SW5pdCBleHRlbmRzIFJlcXVlc3RJbml0IHtcbiAgYWdlbnQ/OiBhbnk7XG59XG5cbmZ1bmN0aW9uIGZldGNoUmVxdWVzdChcbiAgdXJsOiBzdHJpbmcsXG4gIG9uU3VjY2VzczogKF86IFJlcXVlc3RDYWxsYmFja1N1Y2Nlc3MpID0+IHZvaWQsXG4gIG9uRXJyb3I6IChfOiBSZXF1ZXN0Q2FsbGJhY2tGYWlsdXJlKSA9PiB2b2lkLFxuICBvcHRpb25zPzogUmVxdWVzdEhhbmRsZXJPcHRpb24sXG4pOiBhbnkge1xuXG4gIGNvbnN0IGZldGNoT3B0aW9ucyA9IHtcbiAgICBoZWFkZXJzOiB7XG4gICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICB9LFxuICB9IGFzIE5vZGVSZXF1ZXN0SW5pdDtcblxuICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnByb3h5QWdlbnQpIHtcbiAgICBmZXRjaE9wdGlvbnMuYWdlbnQgPSBvcHRpb25zLnByb3h5QWdlbnQ7XG4gIH1cblxuICByZXR1cm4gZmV0Y2godXJsLCBmZXRjaE9wdGlvbnMpLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgaWYgKH5+KHJlc3BvbnNlLnN0YXR1cyAvIDEwMCAhPSAyKSkge1xuICAgICAgdGhyb3cgY3JlYXRlRXJyb3IocmVzcG9uc2Uuc3RhdHVzLCBcIlVuZXhwZWN0ZWQgc3RhdHVzIGNvZGUgW1wiICsgcmVzcG9uc2Uuc3RhdHVzICsgXCJdIG9uIFVSTCBcIiArIHVybCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkudGhlbihmdW5jdGlvbihqc29uKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcmVzcG9uc2UsXG4gICAgICAgICAganNvbixcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSkudGhlbigobmV4dDogYW55KSA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBuZXh0LnJlc3BvbnNlO1xuICAgIGNvbnN0IGpzb24gPSBuZXh0Lmpzb247XG4gICAgY29uc3QgY2FjaGVDb250cm9sID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ2NhY2hlLWNvbnRyb2wnKTtcbiAgICBjb25zdCBwYXJzZWRDYWNoZUNvbnRyb2w6IHN0cmluZ1tdIHwgbnVsbCA9IGNhY2hlQ29udHJvbCA/IC9tYXgtYWdlPShcXGQrKS8uZXhlYyhjYWNoZUNvbnRyb2wpIDogbnVsbDtcbiAgICBjb25zdCB0dGwgPSBwYXJzZWRDYWNoZUNvbnRyb2wgPyBwYXJzZUludChwYXJzZWRDYWNoZUNvbnRyb2xbMV0sIDEwKSA6IHVuZGVmaW5lZDtcbiAgICBvblN1Y2Nlc3Moe3Jlc3VsdDoganNvbiwgeGhyOiByZXNwb25zZSwgdHRsfSBhcyBSZXF1ZXN0Q2FsbGJhY2tTdWNjZXNzKTtcbiAgfSkuY2F0Y2goKGVycm9yOiBFcnJvcikgPT4ge1xuICAgIG9uRXJyb3IoeyBlcnJvciB9IGFzIFJlcXVlc3RDYWxsYmFja0ZhaWx1cmUpO1xuICB9KTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZXF1ZXN0SGFuZGxlciB7XG4gIHJlcXVlc3QodXJsOiBTdHJpbmcsIGNiOiAoZXJyb3I6IEVycm9yIHwgbnVsbCwgcmVzdWx0PzogYW55LCB4aHI/OiBhbnkpID0+IHZvaWQpOiB2b2lkXG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NRdWV1ZShvcHRpb25zPzogUmVxdWVzdEhhbmRsZXJPcHRpb24pIHtcbiAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMCB8fCBydW5uaW5nID49IE1BWF9DT05ORUNUSU9OUykge1xuICAgIHJldHVybjtcbiAgfVxuICBydW5uaW5nKys7XG5cbiAgY29uc3QgbmV4dCA9IHF1ZXVlLnNoaWZ0KCk7XG5cbiAgZmV0Y2hSZXF1ZXN0KFxuICAgIG5leHQudXJsLFxuICAgICh7IHJlc3VsdCwgeGhyLCB0dGwgfTogUmVxdWVzdENhbGxiYWNrU3VjY2VzcykgPT4ge1xuICAgICAgcnVubmluZy0tO1xuICAgICAgbmV4dC5jYWxsYmFjayhudWxsLCByZXN1bHQsIHhociwgdHRsKTtcbiAgICAgIHByb2Nlc3NRdWV1ZShvcHRpb25zKTtcbiAgICB9LFxuICAgICh7IGVycm9yIH06IFJlcXVlc3RDYWxsYmFja0ZhaWx1cmUpID0+IHtcbiAgICAgIG5leHQuY2FsbGJhY2soZXJyb3IpO1xuICAgICAgcHJvY2Vzc1F1ZXVlKG9wdGlvbnMpO1xuICAgIH0sXG4gICAgb3B0aW9ucyxcbiAgKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZXF1ZXN0SGFuZGxlck9wdGlvbiB7XG4gIHByb3h5QWdlbnQ6IGFueTtcbn1cblxuZXhwb3J0IGNsYXNzIERlZmF1bHRSZXF1ZXN0SGFuZGxlciBpbXBsZW1lbnRzIFJlcXVlc3RIYW5kbGVyIHtcblxuICBvcHRpb25zPzogUmVxdWVzdEhhbmRsZXJPcHRpb247XG5cbiAgY29uc3RydWN0b3Iob3B0aW9ucz86IFJlcXVlc3RIYW5kbGVyT3B0aW9uKSB7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgfVxuXG4gIHJlcXVlc3QodXJsOiBTdHJpbmcsIGNiOiAoZXJyb3I6IEVycm9yIHwgbnVsbCwgcmVzdWx0PzogYW55LCB4aHI/OiBhbnksIHR0bD86IG51bWJlcikgPT4gdm9pZCk6IHZvaWQge1xuICAgIHF1ZXVlLnB1c2goe1xuICAgICAgdXJsLFxuICAgICAgY2FsbGJhY2s6IGNiLFxuICAgIH0pO1xuICAgIHByb2Nlc3NRdWV1ZSh0aGlzLm9wdGlvbnMpO1xuICB9XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvcmVxdWVzdC50cyJdLCJtYXBwaW5ncyI6Ijs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWtCQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQU1BO0FBSUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBZkE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///6\n");

/***/ }),
/* 7 */
/*!**********************!*\
  !*** ./src/cache.ts ***!
  \**********************/
/*! no static exports found */
/*! all exports used */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nexports.__esModule = true;\nvar lru_1 = __webpack_require__(/*! ./lru */ 8);\nvar DefaultApiCache = /** @class */ (function () {\n    function DefaultApiCache(limit) {\n        this.lru = lru_1.MakeLRUCache(limit);\n    }\n    DefaultApiCache.prototype.isExpired = function (key) {\n        var entryValue = this.lru.get(key, false);\n        if (entryValue) {\n            return entryValue.expiredIn !== 0 && entryValue.expiredIn < Date.now();\n        }\n        else {\n            return false;\n        }\n    };\n    DefaultApiCache.prototype.get = function (key, cb) {\n        var entryValue = this.lru.get(key, false);\n        if (entryValue && !this.isExpired(key)) {\n            cb(null, entryValue.data);\n        }\n        else {\n            cb();\n        }\n    };\n    DefaultApiCache.prototype.set = function (key, value, ttl, cb) {\n        // this.lru.remove(key);\n        // this.lru.put(key, {\n        //   data: value,\n        //   expiredIn: ttl ? (Date.now() + (ttl * 1000)) : 0\n        // });\n        cb();\n    };\n    DefaultApiCache.prototype.remove = function (key, cb) {\n        this.lru.remove(key);\n        cb();\n    };\n    DefaultApiCache.prototype.clear = function (cb) {\n        this.lru.removeAll();\n        cb();\n    };\n    return DefaultApiCache;\n}());\nexports.DefaultApiCache = DefaultApiCache;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9jYWNoZS50cz84N2I3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElMUlVDYWNoZSwgTWFrZUxSVUNhY2hlIH0gZnJvbSAnLi9scnUnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEFwaUNhY2hlIHtcbiAgaXNFeHBpcmVkKGtleTogU3RyaW5nKTogYm9vbGVhbjtcbiAgZ2V0KGtleTogc3RyaW5nLCBjYjogKGVycm9yID86IEVycm9yIHwgbnVsbCwgZW50cnk/OiBhbnkpID0+IGFueSk6IHZvaWQ7XG4gIHNldChrZXk6IHN0cmluZywgdmFsdWU6IGFueSwgdHRsOiBudW1iZXIsIGNiOiAoZXJyb3IgPzogRXJyb3IpID0+IHZvaWQpOiB2b2lkO1xuICByZW1vdmUoa2V5OiBzdHJpbmcsIGNiOiAoZXJyb3IgPzogRXJyb3IgfCBudWxsKSA9PiBhbnkpOiB2b2lkO1xuICBjbGVhcihjYjogKGVycm9yID86IEVycm9yIHwgbnVsbCkgPT4gYW55KTogdm9pZDtcbn1cblxuZXhwb3J0IGNsYXNzIERlZmF1bHRBcGlDYWNoZSBpbXBsZW1lbnRzIEFwaUNhY2hlIHtcbiAgbHJ1OiBJTFJVQ2FjaGU7XG5cbiAgY29uc3RydWN0b3IobGltaXQgPzogbnVtYmVyKSB7XG4gICAgdGhpcy5scnUgPSBNYWtlTFJVQ2FjaGUobGltaXQpO1xuICB9XG5cbiAgaXNFeHBpcmVkKGtleTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZW50cnlWYWx1ZSA9IHRoaXMubHJ1LmdldChrZXksIGZhbHNlKTtcbiAgICBpZihlbnRyeVZhbHVlKSB7XG4gICAgICByZXR1cm4gZW50cnlWYWx1ZS5leHBpcmVkSW4gIT09IDAgJiYgZW50cnlWYWx1ZS5leHBpcmVkSW4gPCBEYXRlLm5vdygpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZ2V0KGtleTogc3RyaW5nLCBjYjogKGVycm9yID86IEVycm9yIHwgbnVsbCwgZW50cnk/OiBhbnkpID0+IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IGVudHJ5VmFsdWUgPSB0aGlzLmxydS5nZXQoa2V5LCBmYWxzZSk7XG4gICAgaWYoZW50cnlWYWx1ZSAmJiAhdGhpcy5pc0V4cGlyZWQoa2V5KSkge1xuICAgICAgY2IobnVsbCwgZW50cnlWYWx1ZS5kYXRhKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2IoKTtcbiAgICB9XG4gIH1cblxuICBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIHR0bDogbnVtYmVyLCBjYjogKGVycm9yID86IEVycm9yKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgLy8gdGhpcy5scnUucmVtb3ZlKGtleSk7XG4gICAgLy8gdGhpcy5scnUucHV0KGtleSwge1xuICAgIC8vICAgZGF0YTogdmFsdWUsXG4gICAgLy8gICBleHBpcmVkSW46IHR0bCA/IChEYXRlLm5vdygpICsgKHR0bCAqIDEwMDApKSA6IDBcbiAgICAvLyB9KTtcbiAgICBjYigpO1xuICB9XG5cbiAgcmVtb3ZlKGtleTogc3RyaW5nLCBjYjogKGVycm9yID86IEVycm9yIHwgbnVsbCkgPT4gYW55KTogdm9pZCB7XG4gICAgdGhpcy5scnUucmVtb3ZlKGtleSk7XG4gICAgY2IoKTtcbiAgfVxuXG4gIGNsZWFyKGNiOiAoZXJyb3IgPzogRXJyb3IgfCBudWxsKSA9PiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmxydS5yZW1vdmVBbGwoKTtcbiAgICBjYigpO1xuICB9XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvY2FjaGUudHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFVQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQTNDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///7\n");

/***/ }),
/* 8 */
/*!********************!*\
  !*** ./src/lru.ts ***!
  \********************/
/*! no static exports found */
/*! all exports used */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/**\n* A doubly linked list-based Least Recently Used (LRU) cache. Will keep most\n* recently used items while discarding least recently used items when its limit\n* is reached.\n*\n* Licensed under MIT. Copyright (c) 2010 Rasmus Andersson <http://hunch.se/>\n* Typescript-ified by Oleksandr Nikitin <https://tvori.info>\n*\n* Illustration of the design:\n*\n*       entry             entry             entry             entry\n*       ______            ______            ______            ______\n*      | head |.newer => |      |.newer => |      |.newer => | tail |\n*      |  A   |          |  B   |          |  C   |          |  D   |\n*      |______| <= older.|______| <= older.|______| <= older.|______|\n*\n*  removed  <--  <--  <--  <--  <--  <--  <--  <--  <--  <--  <--  added\n*/\nexports.__esModule = true;\nfunction MakeLRUCache(limit) {\n    return new LRUCache(limit);\n}\nexports.MakeLRUCache = MakeLRUCache;\nfunction LRUCache(limit) {\n    // Current size of the cache. (Read-only).\n    this.size = 0;\n    // Maximum number of items this cache can hold.\n    this.limit = limit;\n    this._keymap = {};\n}\n/**\n * Put <value> into the cache associated with <key>. Returns the entry which was\n * removed to make room for the new entry. Otherwise undefined is returned\n * (i.e. if there was enough room already).\n */\nLRUCache.prototype.put = function (key, value) {\n    var entry = { key: key, value: value };\n    // Note: No protection agains replacing, and thus orphan entries. By design.\n    this._keymap[key] = entry;\n    if (this.tail) {\n        // link previous tail to the new tail (entry)\n        this.tail.newer = entry;\n        entry.older = this.tail;\n    }\n    else {\n        // we're first in -- yay\n        this.head = entry;\n    }\n    // add new entry to the end of the linked list -- it's now the freshest entry.\n    this.tail = entry;\n    if (this.size === this.limit) {\n        // we hit the limit -- remove the head\n        return this.shift();\n    }\n    else {\n        // increase the size counter\n        this.size++;\n    }\n};\n/**\n * Purge the least recently used (oldest) entry from the cache. Returns the\n * removed entry or undefined if the cache was empty.\n *\n * If you need to perform any form of finalization of purged items, this is a\n * good place to do it. Simply override/replace this function:\n *\n *   var c = new LRUCache(123);\n *   c.shift = function() {\n *     var entry = LRUCache.prototype.shift.call(this);\n *     doSomethingWith(entry);\n *     return entry;\n *   }\n */\nLRUCache.prototype.shift = function () {\n    // todo: handle special case when limit == 1\n    var entry = this.head;\n    if (entry) {\n        if (this.head.newer) {\n            this.head = this.head.newer;\n            this.head.older = undefined;\n        }\n        else {\n            this.head = undefined;\n        }\n        // Remove last strong reference to <entry> and remove links from the purged\n        // entry being returned:\n        entry.newer = entry.older = undefined;\n        // delete is slow, but we need to do this to avoid uncontrollable growth:\n        delete this._keymap[entry.key];\n    }\n    console.log('purging ', entry.key);\n    return entry;\n};\n/**\n * Get and register recent use of <key>. Returns the value associated with <key>\n * or undefined if not in cache.\n */\nLRUCache.prototype.get = function (key, returnEntry) {\n    // First, find our cache entry\n    var entry = this._keymap[key];\n    if (entry === undefined)\n        return; // Not cached. Sorry.\n    // As <key> was found in the cache, register it as being requested recently\n    if (entry === this.tail) {\n        // Already the most recently used entry, so no need to update the list\n        return returnEntry ? entry : entry.value;\n    }\n    // HEAD--------------TAIL\n    //   <.older   .newer>\n    //  <--- add direction --\n    //   A  B  C  <D>  E\n    if (entry.newer) {\n        if (entry === this.head)\n            this.head = entry.newer;\n        entry.newer.older = entry.older; // C <-- E.\n    }\n    if (entry.older)\n        entry.older.newer = entry.newer; // C. --> E\n    entry.newer = undefined; // D --x\n    entry.older = this.tail; // D. --> E\n    if (this.tail)\n        this.tail.newer = entry; // E. <-- D\n    this.tail = entry;\n    return returnEntry ? entry : entry.value;\n};\n// ----------------------------------------------------------------------------\n// Following code is optional and can be removed without breaking the core\n// functionality.\n/**\n * Check if <key> is in the cache without registering recent use. Feasible if\n * you do not want to chage the state of the cache, but only \"peek\" at it.\n * Returns the entry associated with <key> if found, or undefined if not found.\n */\nLRUCache.prototype.find = function (key) {\n    return this._keymap[key];\n};\n/**\n * Update the value of entry with <key>. Returns the old value, or undefined if\n * entry was not in the cache.\n */\nLRUCache.prototype.set = function (key, value) {\n    var oldvalue;\n    var entry = this.get(key, true);\n    if (entry) {\n        oldvalue = entry.value;\n        entry.value = value;\n    }\n    else {\n        oldvalue = this.put(key, value);\n        if (oldvalue)\n            oldvalue = oldvalue.value;\n    }\n    return oldvalue;\n};\n/**\n * Remove entry <key> from cache and return its value. Returns undefined if not\n * found.\n */\nLRUCache.prototype.remove = function (key) {\n    var entry = this._keymap[key];\n    if (!entry)\n        return;\n    delete this._keymap[entry.key]; // need to do delete unfortunately\n    if (entry.newer && entry.older) {\n        // relink the older entry with the newer entry\n        entry.older.newer = entry.newer;\n        entry.newer.older = entry.older;\n    }\n    else if (entry.newer) {\n        // remove the link to us\n        entry.newer.older = undefined;\n        // link the newer entry to head\n        this.head = entry.newer;\n    }\n    else if (entry.older) {\n        // remove the link to us\n        entry.older.newer = undefined;\n        // link the newer entry to head\n        this.tail = entry.older;\n    }\n    else {\n        this.head = this.tail = undefined;\n    }\n    this.size--;\n    return entry.value;\n};\n/** Removes all entries */\nLRUCache.prototype.removeAll = function () {\n    // This should be safe, as we never expose strong refrences to the outside\n    this.head = this.tail = undefined;\n    this.size = 0;\n    this._keymap = {};\n};\n/**\n * Return an array containing all keys of entries stored in the cache object, in\n * arbitrary order.\n */\nif (typeof Object.keys === 'function') {\n    LRUCache.prototype.keys = function () { return Object.keys(this._keymap); };\n}\nelse {\n    LRUCache.prototype.keys = function () {\n        var keys = [];\n        for (var k in this._keymap)\n            keys.push(k);\n        return keys;\n    };\n}\n/**\n * Call `fun` for each entry. Starting with the newest entry if `desc` is a true\n * value, otherwise starts with the oldest (head) enrty and moves towards the\n * tail.\n *\n * `fun` is called with 3 arguments in the context `context`:\n *   `fun.call(context, Object key, Object value, LRUCache self)`\n */\nLRUCache.prototype.forEach = function (fun, context, desc) {\n    var entry;\n    if (context === true) {\n        desc = true;\n        context = undefined;\n    }\n    else if (typeof context !== 'object')\n        context = this;\n    if (desc) {\n        entry = this.tail;\n        while (entry) {\n            fun.call(context, entry.key, entry.value, this);\n            entry = entry.older;\n        }\n    }\n    else {\n        entry = this.head;\n        while (entry) {\n            fun.call(context, entry.key, entry.value, this);\n            entry = entry.newer;\n        }\n    }\n};\n/** Returns a JSON (array) representation */\n//LRUCache.prototype.toJSON = function () {\n//    var s: IEntry[] = [], entry = this.head;\n//    while (entry) {\n//        s.push({ key: entry.key.toJSON(), value: entry.value.toJSON() });\n//        entry = entry.newer;\n//    }\n//    return s;\n//};\n/** Returns a String representation */\nLRUCache.prototype.toString = function () {\n    var s = '', entry = this.head;\n    while (entry) {\n        s += String(entry.key) + ':' + entry.value;\n        entry = entry.newer;\n        if (entry)\n            s += ' < ';\n    }\n    return s;\n};\n// Export ourselves\n//if (typeof this === 'object') this.LRUCache = LRUCache; \n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9scnUudHM/MWU3OCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiogQSBkb3VibHkgbGlua2VkIGxpc3QtYmFzZWQgTGVhc3QgUmVjZW50bHkgVXNlZCAoTFJVKSBjYWNoZS4gV2lsbCBrZWVwIG1vc3RcbiogcmVjZW50bHkgdXNlZCBpdGVtcyB3aGlsZSBkaXNjYXJkaW5nIGxlYXN0IHJlY2VudGx5IHVzZWQgaXRlbXMgd2hlbiBpdHMgbGltaXRcbiogaXMgcmVhY2hlZC5cbipcbiogTGljZW5zZWQgdW5kZXIgTUlULiBDb3B5cmlnaHQgKGMpIDIwMTAgUmFzbXVzIEFuZGVyc3NvbiA8aHR0cDovL2h1bmNoLnNlLz5cbiogVHlwZXNjcmlwdC1pZmllZCBieSBPbGVrc2FuZHIgTmlraXRpbiA8aHR0cHM6Ly90dm9yaS5pbmZvPlxuKlxuKiBJbGx1c3RyYXRpb24gb2YgdGhlIGRlc2lnbjpcbipcbiogICAgICAgZW50cnkgICAgICAgICAgICAgZW50cnkgICAgICAgICAgICAgZW50cnkgICAgICAgICAgICAgZW50cnlcbiogICAgICAgX19fX19fICAgICAgICAgICAgX19fX19fICAgICAgICAgICAgX19fX19fICAgICAgICAgICAgX19fX19fXG4qICAgICAgfCBoZWFkIHwubmV3ZXIgPT4gfCAgICAgIHwubmV3ZXIgPT4gfCAgICAgIHwubmV3ZXIgPT4gfCB0YWlsIHxcbiogICAgICB8ICBBICAgfCAgICAgICAgICB8ICBCICAgfCAgICAgICAgICB8ICBDICAgfCAgICAgICAgICB8ICBEICAgfFxuKiAgICAgIHxfX19fX198IDw9IG9sZGVyLnxfX19fX198IDw9IG9sZGVyLnxfX19fX198IDw9IG9sZGVyLnxfX19fX198XG4qXG4qICByZW1vdmVkICA8LS0gIDwtLSAgPC0tICA8LS0gIDwtLSAgPC0tICA8LS0gIDwtLSAgPC0tICA8LS0gIDwtLSAgYWRkZWRcbiovXG5cbmV4cG9ydCBmdW5jdGlvbiBNYWtlTFJVQ2FjaGUobGltaXQ6IGFueSk6IElMUlVDYWNoZSB7XG4gICAgcmV0dXJuIG5ldyAoPGFueT5MUlVDYWNoZSkobGltaXQpO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElMUlVDYWNoZSB7XG4gICAgcHV0KGtleTogc3RyaW5nLCB2YWx1ZTogYW55KTogdm9pZDtcbiAgICBnZXQoa2V5OiBzdHJpbmcsIEVudHJ5OiBib29sZWFuKTogYW55O1xuICAgIHJlbW92ZShrZXk6IFN0cmluZyk6IHZvaWQ7XG4gICAgcmVtb3ZlQWxsKCk6IHZvaWQ7XG59XG5cbmZ1bmN0aW9uIExSVUNhY2hlKGxpbWl0OiBudW1iZXIpIHtcbiAgICAvLyBDdXJyZW50IHNpemUgb2YgdGhlIGNhY2hlLiAoUmVhZC1vbmx5KS5cbiAgICB0aGlzLnNpemUgPSAwO1xuICAgIC8vIE1heGltdW0gbnVtYmVyIG9mIGl0ZW1zIHRoaXMgY2FjaGUgY2FuIGhvbGQuXG4gICAgdGhpcy5saW1pdCA9IGxpbWl0O1xuICAgIHRoaXMuX2tleW1hcCA9IHt9O1xufVxuXG5pbnRlcmZhY2UgSUVudHJ5IHtcbiAgICBuZXdlcj86IElFbnRyeTtcbiAgICBvbGRlcj86IElFbnRyeTtcbiAgICBrZXk6IHN0cmluZztcbiAgICB2YWx1ZTogYW55O1xufVxuXG4vKipcbiAqIFB1dCA8dmFsdWU+IGludG8gdGhlIGNhY2hlIGFzc29jaWF0ZWQgd2l0aCA8a2V5Pi4gUmV0dXJucyB0aGUgZW50cnkgd2hpY2ggd2FzXG4gKiByZW1vdmVkIHRvIG1ha2Ugcm9vbSBmb3IgdGhlIG5ldyBlbnRyeS4gT3RoZXJ3aXNlIHVuZGVmaW5lZCBpcyByZXR1cm5lZFxuICogKGkuZS4gaWYgdGhlcmUgd2FzIGVub3VnaCByb29tIGFscmVhZHkpLlxuICovXG5MUlVDYWNoZS5wcm90b3R5cGUucHV0ID0gZnVuY3Rpb24gKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgdmFyIGVudHJ5OiBJRW50cnkgPSB7IGtleToga2V5LCB2YWx1ZTogdmFsdWUgfTtcbiAgICAvLyBOb3RlOiBObyBwcm90ZWN0aW9uIGFnYWlucyByZXBsYWNpbmcsIGFuZCB0aHVzIG9ycGhhbiBlbnRyaWVzLiBCeSBkZXNpZ24uXG4gICAgdGhpcy5fa2V5bWFwW2tleV0gPSBlbnRyeTtcbiAgICBpZiAodGhpcy50YWlsKSB7XG4gICAgICAgIC8vIGxpbmsgcHJldmlvdXMgdGFpbCB0byB0aGUgbmV3IHRhaWwgKGVudHJ5KVxuICAgICAgICB0aGlzLnRhaWwubmV3ZXIgPSBlbnRyeTtcbiAgICAgICAgZW50cnkub2xkZXIgPSB0aGlzLnRhaWw7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gd2UncmUgZmlyc3QgaW4gLS0geWF5XG4gICAgICAgIHRoaXMuaGVhZCA9IGVudHJ5O1xuICAgIH1cbiAgICAvLyBhZGQgbmV3IGVudHJ5IHRvIHRoZSBlbmQgb2YgdGhlIGxpbmtlZCBsaXN0IC0tIGl0J3Mgbm93IHRoZSBmcmVzaGVzdCBlbnRyeS5cbiAgICB0aGlzLnRhaWwgPSBlbnRyeTtcbiAgICBpZiAodGhpcy5zaXplID09PSB0aGlzLmxpbWl0KSB7XG4gICAgICAgIC8vIHdlIGhpdCB0aGUgbGltaXQgLS0gcmVtb3ZlIHRoZSBoZWFkXG4gICAgICAgIHJldHVybiB0aGlzLnNoaWZ0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gaW5jcmVhc2UgdGhlIHNpemUgY291bnRlclxuICAgICAgICB0aGlzLnNpemUrKztcbiAgICB9XG59O1xuXG4vKipcbiAqIFB1cmdlIHRoZSBsZWFzdCByZWNlbnRseSB1c2VkIChvbGRlc3QpIGVudHJ5IGZyb20gdGhlIGNhY2hlLiBSZXR1cm5zIHRoZVxuICogcmVtb3ZlZCBlbnRyeSBvciB1bmRlZmluZWQgaWYgdGhlIGNhY2hlIHdhcyBlbXB0eS5cbiAqXG4gKiBJZiB5b3UgbmVlZCB0byBwZXJmb3JtIGFueSBmb3JtIG9mIGZpbmFsaXphdGlvbiBvZiBwdXJnZWQgaXRlbXMsIHRoaXMgaXMgYVxuICogZ29vZCBwbGFjZSB0byBkbyBpdC4gU2ltcGx5IG92ZXJyaWRlL3JlcGxhY2UgdGhpcyBmdW5jdGlvbjpcbiAqXG4gKiAgIHZhciBjID0gbmV3IExSVUNhY2hlKDEyMyk7XG4gKiAgIGMuc2hpZnQgPSBmdW5jdGlvbigpIHtcbiAqICAgICB2YXIgZW50cnkgPSBMUlVDYWNoZS5wcm90b3R5cGUuc2hpZnQuY2FsbCh0aGlzKTtcbiAqICAgICBkb1NvbWV0aGluZ1dpdGgoZW50cnkpO1xuICogICAgIHJldHVybiBlbnRyeTtcbiAqICAgfVxuICovXG5MUlVDYWNoZS5wcm90b3R5cGUuc2hpZnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gdG9kbzogaGFuZGxlIHNwZWNpYWwgY2FzZSB3aGVuIGxpbWl0ID09IDFcbiAgICB2YXIgZW50cnkgPSB0aGlzLmhlYWQ7XG4gICAgaWYgKGVudHJ5KSB7XG4gICAgICAgIGlmICh0aGlzLmhlYWQubmV3ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuaGVhZCA9IHRoaXMuaGVhZC5uZXdlcjtcbiAgICAgICAgICAgIHRoaXMuaGVhZC5vbGRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaGVhZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICAvLyBSZW1vdmUgbGFzdCBzdHJvbmcgcmVmZXJlbmNlIHRvIDxlbnRyeT4gYW5kIHJlbW92ZSBsaW5rcyBmcm9tIHRoZSBwdXJnZWRcbiAgICAgICAgLy8gZW50cnkgYmVpbmcgcmV0dXJuZWQ6XG4gICAgICAgIGVudHJ5Lm5ld2VyID0gZW50cnkub2xkZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIC8vIGRlbGV0ZSBpcyBzbG93LCBidXQgd2UgbmVlZCB0byBkbyB0aGlzIHRvIGF2b2lkIHVuY29udHJvbGxhYmxlIGdyb3d0aDpcbiAgICAgICAgZGVsZXRlIHRoaXMuX2tleW1hcFtlbnRyeS5rZXldO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZygncHVyZ2luZyAnLCBlbnRyeS5rZXkpO1xuICAgIHJldHVybiBlbnRyeTtcbn07XG5cbi8qKlxuICogR2V0IGFuZCByZWdpc3RlciByZWNlbnQgdXNlIG9mIDxrZXk+LiBSZXR1cm5zIHRoZSB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggPGtleT5cbiAqIG9yIHVuZGVmaW5lZCBpZiBub3QgaW4gY2FjaGUuXG4gKi9cbkxSVUNhY2hlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoa2V5OiBzdHJpbmcsIHJldHVybkVudHJ5OiBib29sZWFuKTogYW55IHtcbiAgICAvLyBGaXJzdCwgZmluZCBvdXIgY2FjaGUgZW50cnlcbiAgICB2YXIgZW50cnkgPSB0aGlzLl9rZXltYXBba2V5XTtcbiAgICBpZiAoZW50cnkgPT09IHVuZGVmaW5lZCkgcmV0dXJuOyAvLyBOb3QgY2FjaGVkLiBTb3JyeS5cbiAgICAvLyBBcyA8a2V5PiB3YXMgZm91bmQgaW4gdGhlIGNhY2hlLCByZWdpc3RlciBpdCBhcyBiZWluZyByZXF1ZXN0ZWQgcmVjZW50bHlcbiAgICBpZiAoZW50cnkgPT09IHRoaXMudGFpbCkge1xuICAgICAgICAvLyBBbHJlYWR5IHRoZSBtb3N0IHJlY2VudGx5IHVzZWQgZW50cnksIHNvIG5vIG5lZWQgdG8gdXBkYXRlIHRoZSBsaXN0XG4gICAgICAgIHJldHVybiByZXR1cm5FbnRyeSA/IGVudHJ5IDogZW50cnkudmFsdWU7XG4gICAgfVxuICAgIC8vIEhFQUQtLS0tLS0tLS0tLS0tLVRBSUxcbiAgICAvLyAgIDwub2xkZXIgICAubmV3ZXI+XG4gICAgLy8gIDwtLS0gYWRkIGRpcmVjdGlvbiAtLVxuICAgIC8vICAgQSAgQiAgQyAgPEQ+ICBFXG4gICAgaWYgKGVudHJ5Lm5ld2VyKSB7XG4gICAgICAgIGlmIChlbnRyeSA9PT0gdGhpcy5oZWFkKVxuICAgICAgICAgICAgdGhpcy5oZWFkID0gZW50cnkubmV3ZXI7XG4gICAgICAgIGVudHJ5Lm5ld2VyLm9sZGVyID0gZW50cnkub2xkZXI7IC8vIEMgPC0tIEUuXG4gICAgfVxuICAgIGlmIChlbnRyeS5vbGRlcilcbiAgICAgICAgZW50cnkub2xkZXIubmV3ZXIgPSBlbnRyeS5uZXdlcjsgLy8gQy4gLS0+IEVcbiAgICBlbnRyeS5uZXdlciA9IHVuZGVmaW5lZDsgLy8gRCAtLXhcbiAgICBlbnRyeS5vbGRlciA9IHRoaXMudGFpbDsgLy8gRC4gLS0+IEVcbiAgICBpZiAodGhpcy50YWlsKVxuICAgICAgICB0aGlzLnRhaWwubmV3ZXIgPSBlbnRyeTsgLy8gRS4gPC0tIERcbiAgICB0aGlzLnRhaWwgPSBlbnRyeTtcbiAgICByZXR1cm4gcmV0dXJuRW50cnkgPyBlbnRyeSA6IGVudHJ5LnZhbHVlO1xufTtcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gRm9sbG93aW5nIGNvZGUgaXMgb3B0aW9uYWwgYW5kIGNhbiBiZSByZW1vdmVkIHdpdGhvdXQgYnJlYWtpbmcgdGhlIGNvcmVcbi8vIGZ1bmN0aW9uYWxpdHkuXG5cbi8qKlxuICogQ2hlY2sgaWYgPGtleT4gaXMgaW4gdGhlIGNhY2hlIHdpdGhvdXQgcmVnaXN0ZXJpbmcgcmVjZW50IHVzZS4gRmVhc2libGUgaWZcbiAqIHlvdSBkbyBub3Qgd2FudCB0byBjaGFnZSB0aGUgc3RhdGUgb2YgdGhlIGNhY2hlLCBidXQgb25seSBcInBlZWtcIiBhdCBpdC5cbiAqIFJldHVybnMgdGhlIGVudHJ5IGFzc29jaWF0ZWQgd2l0aCA8a2V5PiBpZiBmb3VuZCwgb3IgdW5kZWZpbmVkIGlmIG5vdCBmb3VuZC5cbiAqL1xuTFJVQ2FjaGUucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbiAoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fa2V5bWFwW2tleV07XG59O1xuXG4vKipcbiAqIFVwZGF0ZSB0aGUgdmFsdWUgb2YgZW50cnkgd2l0aCA8a2V5Pi4gUmV0dXJucyB0aGUgb2xkIHZhbHVlLCBvciB1bmRlZmluZWQgaWZcbiAqIGVudHJ5IHdhcyBub3QgaW4gdGhlIGNhY2hlLlxuICovXG5MUlVDYWNoZS5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgdmFyIG9sZHZhbHVlOiBhbnk7XG4gICAgdmFyIGVudHJ5ID0gdGhpcy5nZXQoa2V5LCB0cnVlKTtcbiAgICBpZiAoZW50cnkpIHtcbiAgICAgICAgb2xkdmFsdWUgPSBlbnRyeS52YWx1ZTtcbiAgICAgICAgZW50cnkudmFsdWUgPSB2YWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBvbGR2YWx1ZSA9IHRoaXMucHV0KGtleSwgdmFsdWUpO1xuICAgICAgICBpZiAob2xkdmFsdWUpIG9sZHZhbHVlID0gb2xkdmFsdWUudmFsdWU7XG4gICAgfVxuICAgIHJldHVybiBvbGR2YWx1ZTtcbn07XG5cbi8qKlxuICogUmVtb3ZlIGVudHJ5IDxrZXk+IGZyb20gY2FjaGUgYW5kIHJldHVybiBpdHMgdmFsdWUuIFJldHVybnMgdW5kZWZpbmVkIGlmIG5vdFxuICogZm91bmQuXG4gKi9cbkxSVUNhY2hlLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoa2V5OiBzdHJpbmcpIHtcbiAgICB2YXIgZW50cnkgPSB0aGlzLl9rZXltYXBba2V5XTtcbiAgICBpZiAoIWVudHJ5KSByZXR1cm47XG4gICAgZGVsZXRlIHRoaXMuX2tleW1hcFtlbnRyeS5rZXldOyAvLyBuZWVkIHRvIGRvIGRlbGV0ZSB1bmZvcnR1bmF0ZWx5XG4gICAgaWYgKGVudHJ5Lm5ld2VyICYmIGVudHJ5Lm9sZGVyKSB7XG4gICAgICAgIC8vIHJlbGluayB0aGUgb2xkZXIgZW50cnkgd2l0aCB0aGUgbmV3ZXIgZW50cnlcbiAgICAgICAgZW50cnkub2xkZXIubmV3ZXIgPSBlbnRyeS5uZXdlcjtcbiAgICAgICAgZW50cnkubmV3ZXIub2xkZXIgPSBlbnRyeS5vbGRlcjtcbiAgICB9IGVsc2UgaWYgKGVudHJ5Lm5ld2VyKSB7XG4gICAgICAgIC8vIHJlbW92ZSB0aGUgbGluayB0byB1c1xuICAgICAgICBlbnRyeS5uZXdlci5vbGRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgLy8gbGluayB0aGUgbmV3ZXIgZW50cnkgdG8gaGVhZFxuICAgICAgICB0aGlzLmhlYWQgPSBlbnRyeS5uZXdlcjtcbiAgICB9IGVsc2UgaWYgKGVudHJ5Lm9sZGVyKSB7XG4gICAgICAgIC8vIHJlbW92ZSB0aGUgbGluayB0byB1c1xuICAgICAgICBlbnRyeS5vbGRlci5uZXdlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgLy8gbGluayB0aGUgbmV3ZXIgZW50cnkgdG8gaGVhZFxuICAgICAgICB0aGlzLnRhaWwgPSBlbnRyeS5vbGRlcjtcbiAgICB9IGVsc2Ugey8vIGlmKGVudHJ5Lm9sZGVyID09PSB1bmRlZmluZWQgJiYgZW50cnkubmV3ZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLmhlYWQgPSB0aGlzLnRhaWwgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgdGhpcy5zaXplLS07XG4gICAgcmV0dXJuIGVudHJ5LnZhbHVlO1xufTtcblxuLyoqIFJlbW92ZXMgYWxsIGVudHJpZXMgKi9cbkxSVUNhY2hlLnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gVGhpcyBzaG91bGQgYmUgc2FmZSwgYXMgd2UgbmV2ZXIgZXhwb3NlIHN0cm9uZyByZWZyZW5jZXMgdG8gdGhlIG91dHNpZGVcbiAgICB0aGlzLmhlYWQgPSB0aGlzLnRhaWwgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zaXplID0gMDtcbiAgICB0aGlzLl9rZXltYXAgPSB7fTtcbn07XG5cbi8qKlxuICogUmV0dXJuIGFuIGFycmF5IGNvbnRhaW5pbmcgYWxsIGtleXMgb2YgZW50cmllcyBzdG9yZWQgaW4gdGhlIGNhY2hlIG9iamVjdCwgaW5cbiAqIGFyYml0cmFyeSBvcmRlci5cbiAqL1xuaWYgKHR5cGVvZiBPYmplY3Qua2V5cyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIExSVUNhY2hlLnByb3RvdHlwZS5rZXlzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gT2JqZWN0LmtleXModGhpcy5fa2V5bWFwKTsgfTtcbn0gZWxzZSB7XG4gICAgTFJVQ2FjaGUucHJvdG90eXBlLmtleXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBrZXlzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICBmb3IgKHZhciBrIGluIHRoaXMuX2tleW1hcCkga2V5cy5wdXNoKGspO1xuICAgICAgICByZXR1cm4ga2V5cztcbiAgICB9O1xufVxuXG4vKipcbiAqIENhbGwgYGZ1bmAgZm9yIGVhY2ggZW50cnkuIFN0YXJ0aW5nIHdpdGggdGhlIG5ld2VzdCBlbnRyeSBpZiBgZGVzY2AgaXMgYSB0cnVlXG4gKiB2YWx1ZSwgb3RoZXJ3aXNlIHN0YXJ0cyB3aXRoIHRoZSBvbGRlc3QgKGhlYWQpIGVucnR5IGFuZCBtb3ZlcyB0b3dhcmRzIHRoZVxuICogdGFpbC5cbiAqXG4gKiBgZnVuYCBpcyBjYWxsZWQgd2l0aCAzIGFyZ3VtZW50cyBpbiB0aGUgY29udGV4dCBgY29udGV4dGA6XG4gKiAgIGBmdW4uY2FsbChjb250ZXh0LCBPYmplY3Qga2V5LCBPYmplY3QgdmFsdWUsIExSVUNhY2hlIHNlbGYpYFxuICovXG5MUlVDYWNoZS5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uIChmdW46IEZ1bmN0aW9uLCBjb250ZXh0OiBhbnksIGRlc2M6IGJvb2xlYW4pIHtcbiAgICB2YXIgZW50cnk6IElFbnRyeSB8IHVuZGVmaW5lZDtcbiAgICBpZiAoY29udGV4dCA9PT0gdHJ1ZSkgeyBkZXNjID0gdHJ1ZTsgY29udGV4dCA9IHVuZGVmaW5lZDsgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBjb250ZXh0ICE9PSAnb2JqZWN0JykgY29udGV4dCA9IHRoaXM7XG4gICAgaWYgKGRlc2MpIHtcbiAgICAgICAgZW50cnkgPSB0aGlzLnRhaWw7XG4gICAgICAgIHdoaWxlIChlbnRyeSkge1xuICAgICAgICAgICAgZnVuLmNhbGwoY29udGV4dCwgZW50cnkua2V5LCBlbnRyeS52YWx1ZSwgdGhpcyk7XG4gICAgICAgICAgICBlbnRyeSA9IGVudHJ5Lm9sZGVyO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZW50cnkgPSB0aGlzLmhlYWQ7XG4gICAgICAgIHdoaWxlIChlbnRyeSkge1xuICAgICAgICAgICAgZnVuLmNhbGwoY29udGV4dCwgZW50cnkua2V5LCBlbnRyeS52YWx1ZSwgdGhpcyk7XG4gICAgICAgICAgICBlbnRyeSA9IGVudHJ5Lm5ld2VyO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuLyoqIFJldHVybnMgYSBKU09OIChhcnJheSkgcmVwcmVzZW50YXRpb24gKi9cbi8vTFJVQ2FjaGUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHtcbi8vICAgIHZhciBzOiBJRW50cnlbXSA9IFtdLCBlbnRyeSA9IHRoaXMuaGVhZDtcbi8vICAgIHdoaWxlIChlbnRyeSkge1xuLy8gICAgICAgIHMucHVzaCh7IGtleTogZW50cnkua2V5LnRvSlNPTigpLCB2YWx1ZTogZW50cnkudmFsdWUudG9KU09OKCkgfSk7XG4vLyAgICAgICAgZW50cnkgPSBlbnRyeS5uZXdlcjtcbi8vICAgIH1cbi8vICAgIHJldHVybiBzO1xuLy99O1xuXG4vKiogUmV0dXJucyBhIFN0cmluZyByZXByZXNlbnRhdGlvbiAqL1xuTFJVQ2FjaGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzID0gJycsIGVudHJ5ID0gdGhpcy5oZWFkO1xuICAgIHdoaWxlIChlbnRyeSkge1xuICAgICAgICBzICs9IFN0cmluZyhlbnRyeS5rZXkpICsgJzonICsgZW50cnkudmFsdWU7XG4gICAgICAgIGVudHJ5ID0gZW50cnkubmV3ZXI7XG4gICAgICAgIGlmIChlbnRyeSlcbiAgICAgICAgICAgIHMgKz0gJyA8ICc7XG4gICAgfVxuICAgIHJldHVybiBzO1xufTtcblxuLy8gRXhwb3J0IG91cnNlbHZlc1xuLy9pZiAodHlwZW9mIHRoaXMgPT09ICdvYmplY3QnKSB0aGlzLkxSVUNhY2hlID0gTFJVQ2FjaGU7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2xydS50cyJdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQTs7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBU0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7Ozs7Ozs7O0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///8\n");

/***/ }),
/* 9 */
/*!************************!*\
  !*** ./src/cookies.ts ***!
  \************************/
/*! no static exports found */
/*! all exports used */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nexports.__esModule = true;\n// Some portions of code from https://github.com/jshttp/cookie\nvar decode = decodeURIComponent;\nfunction tryDecode(str, decode) {\n    try {\n        return decode(str);\n    }\n    catch (e) {\n        return str;\n    }\n}\nfunction parse(str, options) {\n    if (typeof str !== 'string') {\n        throw new TypeError('argument str must be a string');\n    }\n    var obj = {};\n    var opt = options || {};\n    var pairs = str.split(/; */);\n    var dec = opt.decode || decode;\n    pairs.forEach(function (pair) {\n        var eq_idx = pair.indexOf('=');\n        // skip things that don't look like key=value\n        if (eq_idx < 0) {\n            return;\n        }\n        var key = pair.substr(0, eq_idx).trim();\n        var val = pair.substr(++eq_idx, pair.length).trim();\n        // quoted values\n        if ('\"' == val[0]) {\n            val = val.slice(1, -1);\n        }\n        // only assign once\n        if (undefined == obj[key]) {\n            obj[key] = tryDecode(val, dec);\n        }\n    });\n    return obj;\n}\nexports[\"default\"] = { parse: parse };\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9jb29raWVzLnRzPzE3MWYiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGludGVyZmFjZSBDb29raWUge1xuICBba2V5OiBzdHJpbmddOiBzdHJpbmc7XG4gIHZhbHVlOiBzdHJpbmc7XG59XG5cbi8vIFNvbWUgcG9ydGlvbnMgb2YgY29kZSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9qc2h0dHAvY29va2llXG5cbnZhciBkZWNvZGUgPSBkZWNvZGVVUklDb21wb25lbnQ7XG5cbmZ1bmN0aW9uIHRyeURlY29kZShzdHI6IHN0cmluZywgZGVjb2RlOiAoc3RyOiBzdHJpbmcpID0+IHN0cmluZykge1xuICB0cnkge1xuICAgIHJldHVybiBkZWNvZGUoc3RyKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiBzdHI7XG4gIH1cbn1cblxuZnVuY3Rpb24gcGFyc2Uoc3RyOiBzdHJpbmcsIG9wdGlvbnM/OiBhbnkpIHtcbiAgaWYgKHR5cGVvZiBzdHIgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignYXJndW1lbnQgc3RyIG11c3QgYmUgYSBzdHJpbmcnKTtcbiAgfVxuXG4gIHZhciBvYmogPSA8Q29va2llPnt9O1xuICB2YXIgb3B0ID0gb3B0aW9ucyB8fCB7fTtcbiAgdmFyIHBhaXJzID0gc3RyLnNwbGl0KC87ICovKTtcbiAgdmFyIGRlYyA9IG9wdC5kZWNvZGUgfHwgZGVjb2RlO1xuXG4gIHBhaXJzLmZvckVhY2goZnVuY3Rpb24ocGFpcikge1xuICAgIHZhciBlcV9pZHggPSBwYWlyLmluZGV4T2YoJz0nKTtcblxuICAgIC8vIHNraXAgdGhpbmdzIHRoYXQgZG9uJ3QgbG9vayBsaWtlIGtleT12YWx1ZVxuICAgIGlmIChlcV9pZHggPCAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGtleSA9IHBhaXIuc3Vic3RyKDAsIGVxX2lkeCkudHJpbSgpO1xuICAgIHZhciB2YWwgPSBwYWlyLnN1YnN0cigrK2VxX2lkeCwgcGFpci5sZW5ndGgpLnRyaW0oKTtcblxuICAgIC8vIHF1b3RlZCB2YWx1ZXNcbiAgICBpZiAoJ1wiJyA9PSB2YWxbMF0pIHtcbiAgICAgIHZhbCA9IHZhbC5zbGljZSgxLCAtMSk7XG4gICAgfVxuXG4gICAgLy8gb25seSBhc3NpZ24gb25jZVxuICAgIGlmICh1bmRlZmluZWQgPT0gb2JqW2tleV0pIHtcbiAgICAgIG9ialtrZXldID0gdHJ5RGVjb2RlKHZhbCwgZGVjKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBvYmo7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHsgcGFyc2UgfTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9jb29raWVzLnRzIl0sIm1hcHBpbmdzIjoiOztBQUtBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///9\n");

/***/ })
/******/ ]);
});